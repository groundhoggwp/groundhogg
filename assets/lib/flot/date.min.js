(function(){var root=this,timezoneJS;timezoneJS="undefined"!=typeof exports?exports:root.timezoneJS={},timezoneJS.VERSION="1.0.0";for(var $=root.$||root.jQuery||root.Zepto,fleegix=root.fleegix,DAYS=timezoneJS.Days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],MONTHS=timezoneJS.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],SHORT_MONTHS={},SHORT_DAYS={},EXACT_DATE_TIME={},TZ_REGEXP=new RegExp("^[a-zA-Z]+/"),i=0;i<MONTHS.length;i++)SHORT_MONTHS[MONTHS[i].substr(0,3)]=i;for(i=0;i<DAYS.length;i++)SHORT_DAYS[DAYS[i].substr(0,3)]=i;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(e===this[t])return t;return-1});var _fixWidth=function(e,t){if("number"!=typeof e)throw"not a number: "+e;var i=e.toString();if(e.length>t)return e.substr(e.length-t,e.length);for(;i.length<t;)i="0"+i;return i},_transport=function(e){if(!(fleegix&&void 0!==fleegix.xhr||$&&void 0!==$.ajax))throw new Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.");if(e){if(!e.url)throw new Error("URL must be specified");return"async"in e||(e.async=!0),e.async?fleegix&&fleegix.xhr?fleegix.xhr.send({url:e.url,method:"get",handleSuccess:e.success,handleErr:e.error}):$.ajax({url:e.url,dataType:"text",method:"GET",error:e.error,success:e.success}):fleegix&&fleegix.xhr?fleegix.xhr.doReq({url:e.url,async:!1}):$.ajax({url:e.url,async:!1}).responseText}};timezoneJS.Date=function(){var e=Array.prototype.slice.apply(arguments),t=null,i=null,r=[];switch("[object Array]"===Object.prototype.toString.call(e[0])&&(e=e[0]),"string"==typeof e[e.length-1]&&TZ_REGEXP.test(e[e.length-1])&&(i=e.pop()),e.length){case 0:t=new Date;break;case 1:t=new Date(e[0]);break;default:for(var n=0;n<7;n++)r[n]=e[n]||0;t=new Date(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}this._useCache=!1,this._tzInfo={},this._day=0,this.year=0,this.month=0,this.date=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.timezone=i||null,r.length?this.setFromDateObjProxy(t):this.setFromTimeProxy(t.getTime(),i)},timezoneJS.Date.prototype={getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy().getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+60*this.getTimezoneOffset()*1e3},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){return this._useCache?this._tzInfo:(e=this.timezone?"Etc/UTC"===this.timezone||"Etc/GMT"===this.timezone?{tzOffset:0,tzAbbr:"UTC"}:timezoneJS.timezone.getTzInfo(this._timeProxy,this.timezone):{tzOffset:this.getLocalOffset(),tzAbbr:null},this._tzInfo=e,this._useCache=!0,e);var e},getUTCDateProxy:function(){var e=new Date(this._timeProxy);return e.setUTCMinutes(e.getUTCMinutes()+this.getTimezoneOffset()),e},setDate:function(e){this.setAttribute("date",e)},setFullYear:function(e){this.setAttribute("year",e)},setMonth:function(e){this.setAttribute("month",e)},setYear:function(e){this.setUTCAttribute("year",e)},setHours:function(e){this.setAttribute("hours",e)},setMilliseconds:function(e){this.setAttribute("milliseconds",e)},setMinutes:function(e){this.setAttribute("minutes",e)},setSeconds:function(e){this.setAttribute("seconds",e)},setTime:function(e){if(isNaN(e))throw new Error("Units must be a number.");this.setFromTimeProxy(e,this.timezone)},setUTCDate:function(e){this.setUTCAttribute("date",e)},setUTCFullYear:function(e){this.setUTCAttribute("year",e)},setUTCHours:function(e){this.setUTCAttribute("hours",e)},setUTCMilliseconds:function(e){this.setUTCAttribute("milliseconds",e)},setUTCMinutes:function(e){this.setUTCAttribute("minutes",e)},setUTCMonth:function(e){this.setUTCAttribute("month",e)},setUTCSeconds:function(e){this.setUTCAttribute("seconds",e)},setFromDateObjProxy:function(e){this.year=e.getFullYear(),this.month=e.getMonth(),this.date=e.getDate(),this.hours=e.getHours(),this.minutes=e.getMinutes(),this.seconds=e.getSeconds(),this.milliseconds=e.getMilliseconds(),this._day=e.getDay(),this._dateProxy=e,this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds),this._useCache=!1},setFromTimeProxy:function(e,t){var i,r=new Date(e);i=t?timezoneJS.timezone.getTzInfo(r,t).tzOffset:r.getTimezoneOffset(),r.setTime(e+6e4*(r.getTimezoneOffset()-i)),this.setFromDateObjProxy(r)},setAttribute:function(e,t){if(isNaN(t))throw new Error("Units must be a number.");var i=this._dateProxy;i["set"+("year"===e?"FullYear":e.substr(0,1).toUpperCase()+e.substr(1))](t),this.setFromDateObjProxy(i)},setUTCAttribute:function(e,t){if(isNaN(t))throw new Error("Units must be a number.");var i="year"===e?"FullYear":e.substr(0,1).toUpperCase()+e.substr(1),r=this.getUTCDateProxy();r["setUTC"+i](t),r.setUTCMinutes(r.getUTCMinutes()-this.getTimezoneOffset()),this.setFromTimeProxy(r.getTime()+6e4*this.getTimezoneOffset(),this.timezone)},setTimezone:function(e){var t=this.getTimezoneInfo().tzOffset;this.timezone=e,this._useCache=!1,this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+t)},removeTimezone:function(){this.timezone=null,this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?new timezoneJS.Date(this.getTime(),this.timezone):new timezoneJS.Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleString:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toString:function(e,t){e||(e="yyyy-MM-dd HH:mm:ss");var i=e,r=t?timezoneJS.timezone.getTzInfo(this.getTime(),t):this.getTimezoneInfo(),n=this;t&&(n=this.clone()).setTimezone(t);var a=n.getHours();return i.replace(/a+/g,function(){return"k"}).replace(/y+/g,function(e){return _fixWidth(n.getFullYear(),e.length)}).replace(/d+/g,function(e){return _fixWidth(n.getDate(),e.length)}).replace(/m+/g,function(e){return _fixWidth(n.getMinutes(),e.length)}).replace(/s+/g,function(e){return _fixWidth(n.getSeconds(),e.length)}).replace(/S+/g,function(e){return _fixWidth(n.getMilliseconds(),e.length)}).replace(/M+/g,function(e){var t=n.getMonth(),i=e.length;return i>3?timezoneJS.Months[t]:i>2?timezoneJS.Months[t].substring(0,i):_fixWidth(t+1,i)}).replace(/k+/g,function(){return a>=12?(a>12&&(a-=12),"PM"):"AM"}).replace(/H+/g,function(e){return _fixWidth(a,e.length)}).replace(/E+/g,function(e){return DAYS[n.getDay()].substring(0,e.length)}).replace(/Z+/gi,function(){return r.tzAbbr})},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(e,t,i){var r;++t>12&&(r=parseInt(t/12,10),t%=12,e+=r),t<=2&&(e-=1,t+=12);var n=2-(r=Math.floor(e/100))+Math.floor(r/4);return Math.floor(365.25*(e+4716))+Math.floor(30.6001*(t+1))+i+n-1524},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}},timezoneJS.timezone=new function(){var _this=this,regionMap={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:"northamerica",Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},regionExceptions={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe","America/Argentina/Buenos_Aires":"southamerica","America/Argentina/Cordoba":"southamerica","America/Argentina/Tucuman":"southamerica","America/Argentina/La_Rioja":"southamerica","America/Argentina/San_Juan":"southamerica","America/Argentina/Jujuy":"southamerica","America/Argentina/Catamarca":"southamerica","America/Argentina/Mendoza":"southamerica","America/Argentina/Rio_Gallegos":"southamerica","America/Argentina/Ushuaia":"southamerica","America/Aruba":"southamerica","America/La_Paz":"southamerica","America/Noronha":"southamerica","America/Belem":"southamerica","America/Fortaleza":"southamerica","America/Recife":"southamerica","America/Araguaina":"southamerica","America/Maceio":"southamerica","America/Bahia":"southamerica","America/Sao_Paulo":"southamerica","America/Campo_Grande":"southamerica","America/Cuiaba":"southamerica","America/Porto_Velho":"southamerica","America/Boa_Vista":"southamerica","America/Manaus":"southamerica","America/Eirunepe":"southamerica","America/Rio_Branco":"southamerica","America/Santiago":"southamerica","Pacific/Easter":"southamerica","America/Bogota":"southamerica","America/Curacao":"southamerica","America/Guayaquil":"southamerica","Pacific/Galapagos":"southamerica","Atlantic/Stanley":"southamerica","America/Cayenne":"southamerica","America/Guyana":"southamerica","America/Asuncion":"southamerica","America/Lima":"southamerica","Atlantic/South_Georgia":"southamerica","America/Paramaribo":"southamerica","America/Port_of_Spain":"southamerica","America/Montevideo":"southamerica","America/Caracas":"southamerica"};function invalidTZError(e){throw new Error('Timezone "'+e+'" is either incorrect, or not loaded in the timezone registry.')}function builtInLoadZoneFile(e,t){var i=_this.zoneFileBasePath+"/"+e;return t&&t.async?_this.transport({async:!0,url:i,success:function(e){return _this.parseZones(e)&&"function"==typeof t.callback&&t.callback(),!0},error:function(){throw new Error('Error retrieving "'+i+'" zoneinfo files')}}):_this.parseZones(_this.transport({url:i,async:!1}))}function getRegionForTimezone(e){var t,i,r=regionExceptions[e];if(r)return r;if(t=e.split("/")[0],i=regionMap[t])return i;var n=_this.zones[e];return"string"==typeof n?getRegionForTimezone(n):_this.loadedZones.backward?void invalidTZError(e):(_this.loadZoneFile("backward"),getRegionForTimezone(e))}function parseTimeString(e){var t=e.match(/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/);return t[1]=parseInt(t[1],10),t[2]=t[2]?parseInt(t[2],10):0,t[3]=t[3]?parseInt(t[3],10):0,t}function processZone(e){if(e[3]){var t=parseInt(e[3],10),i=11,r=31;e[4]&&(i=SHORT_MONTHS[e[4].substr(0,3)],r=parseInt(e[5],10)||1);var n=parseTimeString(e[6]?e[6]:"00:00:00");return[t,i,r,n[1],n[2],n[3]]}}function getZone(e,t){for(var i="number"==typeof e?e:new Date(e).getTime(),r=t,n=_this.zones[r];"string"==typeof n;)r=n,n=_this.zones[r];if(!n){if(!_this.loadedZones.backward)return _this.loadZoneFile("backward"),getZone(e,t);invalidTZError(r)}if(0===n.length)throw new Error('No Zone found for "'+t+'" on '+e);for(var a=n.length-1;a>=0;a--){var o=n[a];if(o[3]&&i>o[3])break}return n[a+1]}function getBasicOffset(e){var t=parseTimeString(e);return(t=(0===e.indexOf("-")?-1:1)*(1e3*(60*(60*t[1]+t[2])+t[3])))/60/1e3}function getRule(e,t,i){var r,n="number"==typeof e?new Date(e):e,a=t[1],o=t[0],s=function(e,t,i){var r=0;if("u"===t||"g"===t||"z"===t)r=0;else if("s"===t)r=o;else{if("w"!==t&&t)throw"unknown type "+t;r=getAdjustedOffset(o,i)}return r*=6e4,new Date(e.getTime()+r)},u=function(e,t){var i,r=e[0],n=e[1],a=n[5];if(EXACT_DATE_TIME[r]||(EXACT_DATE_TIME[r]={}),EXACT_DATE_TIME[r][n])i=EXACT_DATE_TIME[r][n];else{if(isNaN(n[4])){var o,u;"last"===n[4].substr(0,4)?(i=new Date(Date.UTC(r,SHORT_MONTHS[n[3]]+1,1,a[1]-24,a[2],a[3],0)),o=SHORT_DAYS[n[4].substr(4,3)],u="<="):(i=new Date(Date.UTC(r,SHORT_MONTHS[n[3]],n[4].substr(5),a[1],a[2],a[3],0)),o=SHORT_DAYS[n[4].substr(0,3)],u=n[4].substr(3,2));var c=i.getUTCDay();">="===u?i.setUTCDate(i.getUTCDate()+(o-c+(o<c?7:0))):i.setUTCDate(i.getUTCDate()+(o-c-(o>c?7:0)))}else i=new Date(Date.UTC(r,SHORT_MONTHS[n[3]],n[4],a[1],a[2],a[3],0));EXACT_DATE_TIME[r][n]=i}return t&&(i=s(i,a[4],t)),i},c=function(e,t){for(var i=[],r=0;t&&r<t.length;r++)t[r][0]<=e&&(t[r][1]>=e||t[r][0]===e&&"only"===t[r][1]||"max"===t[r][1])&&i.push([e,t[r]]);return i},h=function(e,t,r){var n,a;return e.constructor!==Date?(n=e[0],a=e[1],e=!r&&EXACT_DATE_TIME[n]&&EXACT_DATE_TIME[n][a]?EXACT_DATE_TIME[n][a]:u(e,r)):r&&(e=s(e,i?"u":"w",r)),t.constructor!==Date?(n=t[0],a=t[1],t=!r&&EXACT_DATE_TIME[n]&&EXACT_DATE_TIME[n][a]?EXACT_DATE_TIME[n][a]:u(t,r)):r&&(t=s(t,i?"u":"w",r)),(e=Number(e))-(t=Number(t))},l=n.getUTCFullYear();(r=c(l,_this.rules[a])).push(n),r.sort(h),r.indexOf(n)<2&&(r=r.concat(c(l-1,_this.rules[a]))).sort(h);var f=r.indexOf(n);return f>1&&h(n,r[f-1],r[f-2][1])<0?r[f-2][1]:f>0&&f<r.length-1&&h(n,r[f+1],r[f-1][1])>0?r[f+1][1]:0===f?null:r[f-1][1]}function getAdjustedOffset(e,t){return-Math.ceil(t[6]-e)}function getAbbreviation(e,t){var i,r,n=e[2];n.indexOf("%s")>-1?(r=t?"-"===t[7]?"":t[7]:"S",i=n.replace("%s",r)):i=n.indexOf("/")>-1?n.split("/",2)[t[6]?1:0]:n;return i}this.zoneFileBasePath,this.zoneFiles=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"},this.loadingScheme=this.loadingSchemes.LAZY_LOAD,this.loadedZones={},this.zones={},this.rules={},this.init=function(e){var t,i={async:!0},r=this.defaultZoneFile=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:"northamerica",n=0;for(var a in e)i[a]=e[a];if("string"==typeof r)return this.loadZoneFile(r,i);t=i.callback,i.callback=function(){++n===r.length&&"function"==typeof t&&t()};for(var o=0;o<r.length;o++)this.loadZoneFile(r[o],i)},this.loadZoneFile=function(e,t){if(void 0===this.zoneFileBasePath)throw new Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath.");if(!this.loadedZones[e])return this.loadedZones[e]=!0,builtInLoadZoneFile(e,t)},this.loadZoneJSONData=function(url,sync){var processData=function(data){for(var z in data=eval("("+data+")"),data.zones)_this.zones[z]=data.zones[z];for(var r in data.rules)_this.rules[r]=data.rules[r]};return sync?processData(_this.transport({url:url,async:!1})):_this.transport({url:url,success:processData})},this.loadZoneDataFromObject=function(e){if(e){for(var t in e.zones)_this.zones[t]=e.zones[t];for(var i in e.rules)_this.rules[i]=e.rules[i]}},this.getAllZones=function(){var e=[];for(var t in this.zones)e.push(t);return e.sort()},this.parseZones=function(e){for(var t,i=e.split("\n"),r=[],n=null,a=null,o=0;o<i.length;o++)if((t=i[o]).match(/^\s/)&&(t="Zone "+n+t),(t=t.split("#")[0]).length>3)switch((r=t.split(/\s+/)).shift()){case"Zone":if(n=r.shift(),_this.zones[n]||(_this.zones[n]=[]),r.length<3)break;r.splice(3,r.length,processZone(r)),r[3]&&(r[3]=Date.UTC.apply(null,r[3])),r[0]=-getBasicOffset(r[0]),_this.zones[n].push(r);break;case"Rule":a=r.shift(),_this.rules[a]||(_this.rules[a]=[]),r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10)||r[1],r[5]=parseTimeString(r[5]),r[6]=getBasicOffset(r[6]),_this.rules[a].push(r);break;case"Link":if(_this.zones[r[1]])throw new Error("Error with Link "+r[1]+". Cannot create link of a preexisted zone.");_this.zones[r[1]]=r[0]}return!0},this.transport=_transport,this.getTzInfo=function(e,t,i){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var r=getRegionForTimezone(t);if(!r)throw new Error("Not a valid timezone ID.");this.loadedZones[r]||this.loadZoneFile(r)}var n=getZone(e,t),a=n[0],o=getRule(e,n,i);return o&&(a=getAdjustedOffset(a,o)),{tzOffset:a,tzAbbr:getAbbreviation(n,o)}}}}).call(this);