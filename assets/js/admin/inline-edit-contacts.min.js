window.wp=window.wp||{};(function($){$(function(){$("#search_contacts").click(function(){$("#search-filters").toggleClass("hidden")})})})(jQuery);var inlineEditContact;(function($,wp,endpoints,nonces){inlineEditContact={init:function(){var t=this,qeRow=$("#inline-edit");t.type="contact";t.what="#contact-";qeRow.keyup(function(e){if(e.which===27){return inlineEditContact.revert()}});$(".cancel",qeRow).click(function(){return inlineEditContact.revert()});$(".save",qeRow).click(function(){return inlineEditContact.save(this)});$("td",qeRow).keydown(function(e){if(e.which===13&&!$(e.target).hasClass("cancel")){return inlineEditContact.save(this)}});$("#the-list").on("click","a.editinline",function(e){e.preventDefault();inlineEditContact.edit(this)})},edit:function(id){var t=this,fields,editRow,rowData;t.revert();id=t.getId(id);fields=["email","first_name","last_name","optin_status","owner","mobile_phone","primary_phone","primary_phone_extension"];editRow=$("#inline-edit").clone(true);$("td",editRow).attr("colspan",$("th:visible, td:visible",".widefat:first thead").length);$(t.what+id).removeClass("is-expanded").hide().after(editRow).after('<tr class="hidden"></tr>');rowData=$("#inline_"+id);for(f=0;f<fields.length;f++){val=$("."+fields[f],rowData);$(':input[name="'+fields[f]+'"]',editRow).val(val.text())}var tags=$("#tags");tags.css("width","100%");tags.select2({tags:true,multiple:true,tokenSeparators:["/",",",";"],data:JSON.parse($(".tags-data",rowData).html()),ajax:{url:endpoints.tags,dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",nonces._wprest)},results:function(data,page){return{results:data.results}}}});tags.val(JSON.parse($(".tags",rowData).html()));tags.trigger("change");$(editRow).attr("id","edit-"+id).addClass("inline-editor").show();$(".cemail",editRow).focus();return false},save:function(id){var params,fields;if(typeof id==="object"){id=this.getId(id)}$("table.widefat .spinner").addClass("is-active");params={action:"wpgh_inline_save_contacts",ID:id};fields=$("#edit-"+id).find(":input").serialize();params=fields+"&"+$.param(params);console.log(params);$.post(ajaxurl,params,function(r){var $errorNotice=$("#edit-"+id+" .inline-edit-save .notice-error"),$error=$errorNotice.find(".error");$("table.widefat .spinner").removeClass("is-active");$(".ac_results").hide();if(r){if(-1!==r.indexOf("<tr")){$(inlineEditContact.what+id).siblings("tr.hidden").addBack().remove();$("#edit-"+id).before(r).remove();$(inlineEditContact.what+id).hide().fadeIn(400,function(){$(this).find(".editinline").focus()})}else{r=r.replace(/<.[^<>]*?>/g,"");$errorNotice.removeClass("hidden");$error.html(r)}}else{$errorNotice.removeClass("hidden");$error.html(inlineEditL10n.error)}},"html");return false},revert:function(){var $tableWideFat=$(".widefat"),id=$(".inline-editor",$tableWideFat).attr("id");if(id){$(".spinner",$tableWideFat).removeClass("is-active");$(".ac_results").hide();$("#"+id).siblings("tr.hidden").addBack().remove();id=id.substr(id.lastIndexOf("-")+1);$(this.what+id).show().find(".editinline").focus()}return false},getId:function(o){var id=$(o).closest("tr").attr("id"),parts=id.split("-");return parts[parts.length-1]}};$(document).ready(function(){inlineEditContact.init()})})(jQuery,window.wp,groundhogg_endpoints,groundhogg_nonces);