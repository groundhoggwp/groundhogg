{"version":3,"sources":["@wordpress/block-editor/src/components/block-compare/index.js"],"names":["classnames","castArray","diffChars","__","getSaveContent","getSaveElement","BlockView","BlockCompare","block","onKeep","onConvert","convertor","convertButtonText","getDifference","originalContent","newContent","difference","map","item","pos","classes","added","removed","value","getConvertedContent","convertedBlock","newBlocks","name","attributes","innerBlocks","renderedContent","rawContent","join","original","converted"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { castArray } from 'lodash';\n// diff doesn't tree-shake correctly, so we import from the individual\n// module here, to avoid including too much of the library\nimport { diffChars } from 'diff/lib/diff/character';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { getSaveContent, getSaveElement } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport BlockView from './block-view';\n\nfunction BlockCompare( {\n\tblock,\n\tonKeep,\n\tonConvert,\n\tconvertor,\n\tconvertButtonText,\n} ) {\n\tfunction getDifference( originalContent, newContent ) {\n\t\tconst difference = diffChars( originalContent, newContent );\n\n\t\treturn difference.map( ( item, pos ) => {\n\t\t\tconst classes = classnames( {\n\t\t\t\t'block-editor-block-compare__added': item.added,\n\t\t\t\t'block-editor-block-compare__removed': item.removed,\n\t\t\t} );\n\n\t\t\treturn (\n\t\t\t\t<span key={ pos } className={ classes }>\n\t\t\t\t\t{ item.value }\n\t\t\t\t</span>\n\t\t\t);\n\t\t} );\n\t}\n\n\tfunction getConvertedContent( convertedBlock ) {\n\t\t// The convertor may return an array of items or a single item\n\t\tconst newBlocks = castArray( convertedBlock );\n\n\t\t// Get converted block details\n\t\tconst newContent = newBlocks.map( ( item ) =>\n\t\t\tgetSaveContent( item.name, item.attributes, item.innerBlocks )\n\t\t);\n\t\tconst renderedContent = newBlocks.map( ( item ) =>\n\t\t\tgetSaveElement( item.name, item.attributes, item.innerBlocks )\n\t\t);\n\n\t\treturn {\n\t\t\trawContent: newContent.join( '' ),\n\t\t\trenderedContent,\n\t\t};\n\t}\n\n\tconst original = {\n\t\trawContent: block.originalContent,\n\t\trenderedContent: getSaveElement( block.name, block.attributes ),\n\t};\n\tconst converted = getConvertedContent( convertor( block ) );\n\tconst difference = getDifference(\n\t\toriginal.rawContent,\n\t\tconverted.rawContent\n\t);\n\n\treturn (\n\t\t<div className=\"block-editor-block-compare__wrapper\">\n\t\t\t<BlockView\n\t\t\t\ttitle={ __( 'Current' ) }\n\t\t\t\tclassName=\"block-editor-block-compare__current\"\n\t\t\t\taction={ onKeep }\n\t\t\t\tactionText={ __( 'Convert to HTML' ) }\n\t\t\t\trawContent={ original.rawContent }\n\t\t\t\trenderedContent={ original.renderedContent }\n\t\t\t/>\n\n\t\t\t<BlockView\n\t\t\t\ttitle={ __( 'After Conversion' ) }\n\t\t\t\tclassName=\"block-editor-block-compare__converted\"\n\t\t\t\taction={ onConvert }\n\t\t\t\tactionText={ convertButtonText }\n\t\t\t\trawContent={ difference }\n\t\t\t\trenderedContent={ converted.renderedContent }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\nexport default BlockCompare;\n"]}