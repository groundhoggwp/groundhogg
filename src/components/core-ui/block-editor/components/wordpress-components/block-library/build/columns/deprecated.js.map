{"version":3,"sources":["@wordpress/block-library/src/columns/deprecated.js"],"names":["getDeprecatedLayoutColumn","originalContent","doc","document","implementation","createHTMLDocument","columnMatch","body","innerHTML","firstChild","classList","classListItem","match","Number","migrateCustomColors","attributes","customTextColor","customBackgroundColor","style","color","text","background","verticalAlignment","type","backgroundColor","textColor","migrate","save","backgroundClass","textClass","className","undefined","columns","default","isEligible","innerBlocks","isFastPassEligible","some","innerBlock","test","reduce","accumulator","columnIndex","push","migratedInnerBlocks","map","columnBlocks","wrapperClasses"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { omit } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { createBlock } from '@wordpress/blocks';\nimport { InnerBlocks, getColorClassName } from '@wordpress/block-editor';\n\n/**\n * Given an HTML string for a deprecated columns inner block, returns the\n * column index to which the migrated inner block should be assigned. Returns\n * undefined if the inner block was not assigned to a column.\n *\n * @param {string} originalContent Deprecated Columns inner block HTML.\n *\n * @return {?number} Column to which inner block is to be assigned.\n */\nfunction getDeprecatedLayoutColumn( originalContent ) {\n\tlet { doc } = getDeprecatedLayoutColumn;\n\tif ( ! doc ) {\n\t\tdoc = document.implementation.createHTMLDocument( '' );\n\t\tgetDeprecatedLayoutColumn.doc = doc;\n\t}\n\n\tlet columnMatch;\n\n\tdoc.body.innerHTML = originalContent;\n\tfor ( const classListItem of doc.body.firstChild.classList ) {\n\t\tif (\n\t\t\t( columnMatch = classListItem.match( /^layout-column-(\\d+)$/ ) )\n\t\t) {\n\t\t\treturn Number( columnMatch[ 1 ] ) - 1;\n\t\t}\n\t}\n}\n\nconst migrateCustomColors = ( attributes ) => {\n\tif ( ! attributes.customTextColor && ! attributes.customBackgroundColor ) {\n\t\treturn attributes;\n\t}\n\tconst style = { color: {} };\n\tif ( attributes.customTextColor ) {\n\t\tstyle.color.text = attributes.customTextColor;\n\t}\n\tif ( attributes.customBackgroundColor ) {\n\t\tstyle.color.background = attributes.customBackgroundColor;\n\t}\n\treturn {\n\t\t...omit( attributes, [ 'customTextColor', 'customBackgroundColor' ] ),\n\t\tstyle,\n\t};\n};\n\nexport default [\n\t{\n\t\tattributes: {\n\t\t\tverticalAlignment: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\tbackgroundColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\tcustomBackgroundColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\tcustomTextColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t\ttextColor: {\n\t\t\t\ttype: 'string',\n\t\t\t},\n\t\t},\n\t\tmigrate: migrateCustomColors,\n\t\tsave( { attributes } ) {\n\t\t\tconst {\n\t\t\t\tverticalAlignment,\n\t\t\t\tbackgroundColor,\n\t\t\t\tcustomBackgroundColor,\n\t\t\t\ttextColor,\n\t\t\t\tcustomTextColor,\n\t\t\t} = attributes;\n\n\t\t\tconst backgroundClass = getColorClassName(\n\t\t\t\t'background-color',\n\t\t\t\tbackgroundColor\n\t\t\t);\n\n\t\t\tconst textClass = getColorClassName( 'color', textColor );\n\n\t\t\tconst className = classnames( {\n\t\t\t\t'has-background': backgroundColor || customBackgroundColor,\n\t\t\t\t'has-text-color': textColor || customTextColor,\n\t\t\t\t[ backgroundClass ]: backgroundClass,\n\t\t\t\t[ textClass ]: textClass,\n\t\t\t\t[ `are-vertically-aligned-${ verticalAlignment }` ]: verticalAlignment,\n\t\t\t} );\n\n\t\t\tconst style = {\n\t\t\t\tbackgroundColor: backgroundClass\n\t\t\t\t\t? undefined\n\t\t\t\t\t: customBackgroundColor,\n\t\t\t\tcolor: textClass ? undefined : customTextColor,\n\t\t\t};\n\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={ className ? className : undefined }\n\t\t\t\t\tstyle={ style }\n\t\t\t\t>\n\t\t\t\t\t<InnerBlocks.Content />\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t},\n\t{\n\t\tattributes: {\n\t\t\tcolumns: {\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 2,\n\t\t\t},\n\t\t},\n\t\tisEligible( attributes, innerBlocks ) {\n\t\t\t// Since isEligible is called on every valid instance of the\n\t\t\t// Columns block and a deprecation is the unlikely case due to\n\t\t\t// its subsequent migration, optimize for the `false` condition\n\t\t\t// by performing a naive, inaccurate pass at inner blocks.\n\t\t\tconst isFastPassEligible = innerBlocks.some( ( innerBlock ) =>\n\t\t\t\t/layout-column-\\d+/.test( innerBlock.originalContent )\n\t\t\t);\n\n\t\t\tif ( ! isFastPassEligible ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Only if the fast pass is considered eligible is the more\n\t\t\t// accurate, durable, slower condition performed.\n\t\t\treturn innerBlocks.some(\n\t\t\t\t( innerBlock ) =>\n\t\t\t\t\tgetDeprecatedLayoutColumn( innerBlock.originalContent ) !==\n\t\t\t\t\tundefined\n\t\t\t);\n\t\t},\n\t\tmigrate( attributes, innerBlocks ) {\n\t\t\tconst columns = innerBlocks.reduce( ( accumulator, innerBlock ) => {\n\t\t\t\tconst { originalContent } = innerBlock;\n\n\t\t\t\tlet columnIndex = getDeprecatedLayoutColumn( originalContent );\n\t\t\t\tif ( columnIndex === undefined ) {\n\t\t\t\t\tcolumnIndex = 0;\n\t\t\t\t}\n\n\t\t\t\tif ( ! accumulator[ columnIndex ] ) {\n\t\t\t\t\taccumulator[ columnIndex ] = [];\n\t\t\t\t}\n\n\t\t\t\taccumulator[ columnIndex ].push( innerBlock );\n\n\t\t\t\treturn accumulator;\n\t\t\t}, [] );\n\n\t\t\tconst migratedInnerBlocks = columns.map( ( columnBlocks ) =>\n\t\t\t\tcreateBlock( 'core/column', {}, columnBlocks )\n\t\t\t);\n\n\t\t\treturn [ omit( attributes, [ 'columns' ] ), migratedInnerBlocks ];\n\t\t},\n\t\tsave( { attributes } ) {\n\t\t\tconst { columns } = attributes;\n\n\t\t\treturn (\n\t\t\t\t<div className={ `has-${ columns }-columns` }>\n\t\t\t\t\t<InnerBlocks.Content />\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t},\n\t{\n\t\tattributes: {\n\t\t\tcolumns: {\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 2,\n\t\t\t},\n\t\t},\n\t\tmigrate( attributes, innerBlocks ) {\n\t\t\tattributes = omit( attributes, [ 'columns' ] );\n\n\t\t\treturn [ attributes, innerBlocks ];\n\t\t},\n\t\tsave( { attributes } ) {\n\t\t\tconst { verticalAlignment, columns } = attributes;\n\n\t\t\tconst wrapperClasses = classnames( `has-${ columns }-columns`, {\n\t\t\t\t[ `are-vertically-aligned-${ verticalAlignment }` ]: verticalAlignment,\n\t\t\t} );\n\n\t\t\treturn (\n\t\t\t\t<div className={ wrapperClasses }>\n\t\t\t\t\t<InnerBlocks.Content />\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t},\n];\n"]}