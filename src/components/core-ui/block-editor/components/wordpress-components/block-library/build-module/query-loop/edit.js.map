{"version":3,"sources":["@wordpress/block-library/src/query-loop/edit.js"],"names":["useState","useMemo","useSelect","BlockContextProvider","InnerBlocks","BlockPreview","__experimentalUseBlockWrapperProps","useBlockWrapperProps","useQueryContext","TEMPLATE","QueryLoopEdit","clientId","context","query","perPage","offset","categoryIds","tagIds","order","orderBy","author","search","queryContext","page","activeBlockContext","setActiveBlockContext","select","categories","tags","orderby","per_page","posts","getEntityRecords","blocks","getBlocks","blockContexts","map","post","postType","type","postId","id","blockWrapperProps","blockContext"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, useMemo } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport {\n\tBlockContextProvider,\n\tInnerBlocks,\n\tBlockPreview,\n\t__experimentalUseBlockWrapperProps as useBlockWrapperProps,\n} from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { useQueryContext } from '../query';\n\nconst TEMPLATE = [ [ 'core/post-title' ], [ 'core/post-content' ] ];\nexport default function QueryLoopEdit( {\n\tclientId,\n\tcontext: {\n\t\tquery: {\n\t\t\tperPage,\n\t\t\toffset,\n\t\t\tcategoryIds,\n\t\t\ttagIds = [],\n\t\t\torder,\n\t\t\torderBy,\n\t\t\tauthor,\n\t\t\tsearch,\n\t\t} = {},\n\t\tqueryContext,\n\t},\n} ) {\n\tconst [ { page } ] = useQueryContext() || queryContext || [ {} ];\n\tconst [ activeBlockContext, setActiveBlockContext ] = useState();\n\n\tconst { posts, blocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst query = {\n\t\t\t\toffset: perPage ? perPage * ( page - 1 ) + offset : 0,\n\t\t\t\tcategories: categoryIds,\n\t\t\t\ttags: tagIds,\n\t\t\t\torder,\n\t\t\t\torderby: orderBy,\n\t\t\t};\n\t\t\tif ( perPage ) {\n\t\t\t\tquery.per_page = perPage;\n\t\t\t}\n\t\t\tif ( author ) {\n\t\t\t\tquery.author = author;\n\t\t\t}\n\t\t\tif ( search ) {\n\t\t\t\tquery.search = search;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tposts: select( 'core' ).getEntityRecords(\n\t\t\t\t\t'postType',\n\t\t\t\t\t'post',\n\t\t\t\t\tquery\n\t\t\t\t),\n\t\t\t\tblocks: select( 'core/block-editor' ).getBlocks( clientId ),\n\t\t\t};\n\t\t},\n\t\t[\n\t\t\tperPage,\n\t\t\tpage,\n\t\t\toffset,\n\t\t\tcategoryIds,\n\t\t\ttagIds,\n\t\t\torder,\n\t\t\torderBy,\n\t\t\tclientId,\n\t\t\tauthor,\n\t\t\tsearch,\n\t\t]\n\t);\n\n\tconst blockContexts = useMemo(\n\t\t() =>\n\t\t\tposts?.map( ( post ) => ( {\n\t\t\t\tpostType: post.type,\n\t\t\t\tpostId: post.id,\n\t\t\t} ) ),\n\t\t[ posts ]\n\t);\n\tconst blockWrapperProps = useBlockWrapperProps();\n\n\treturn (\n\t\t<div { ...blockWrapperProps }>\n\t\t\t{ blockContexts &&\n\t\t\t\tblockContexts.map( ( blockContext ) => (\n\t\t\t\t\t<BlockContextProvider\n\t\t\t\t\t\tkey={ blockContext.postId }\n\t\t\t\t\t\tvalue={ blockContext }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ blockContext ===\n\t\t\t\t\t\t( activeBlockContext || blockContexts[ 0 ] ) ? (\n\t\t\t\t\t\t\t<InnerBlocks template={ TEMPLATE } />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<BlockPreview\n\t\t\t\t\t\t\t\tblocks={ blocks }\n\t\t\t\t\t\t\t\t__experimentalLive\n\t\t\t\t\t\t\t\t__experimentalOnClick={ () =>\n\t\t\t\t\t\t\t\t\tsetActiveBlockContext( blockContext )\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</BlockContextProvider>\n\t\t\t\t) ) }\n\t\t</div>\n\t);\n}\n"]}