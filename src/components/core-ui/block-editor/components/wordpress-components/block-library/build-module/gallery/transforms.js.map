{"version":3,"sources":["@wordpress/block-library/src/gallery/transforms.js"],"names":["filter","every","toString","createBlock","createBlobURL","pickRelevantMediaFiles","LINK_DESTINATION_ATTACHMENT","parseShortcodeIds","ids","split","map","id","parseInt","transforms","from","type","isMultiBlock","blocks","transform","attributes","align","sizeSlug","undefined","validImages","url","images","alt","caption","tag","shortcode","named","columns","linkTo","link","isMatch","files","length","file","indexOf","block","to","index"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { filter, every, toString } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { createBlock } from '@wordpress/blocks';\nimport { createBlobURL } from '@wordpress/blob';\n\n/**\n * Internal dependencies\n */\nimport { pickRelevantMediaFiles } from './shared';\nimport { LINK_DESTINATION_ATTACHMENT } from './constants';\n\nconst parseShortcodeIds = ( ids ) => {\n\tif ( ! ids ) {\n\t\treturn [];\n\t}\n\n\treturn ids.split( ',' ).map( ( id ) => parseInt( id, 10 ) );\n};\n\nconst transforms = {\n\tfrom: [\n\t\t{\n\t\t\ttype: 'block',\n\t\t\tisMultiBlock: true,\n\t\t\tblocks: [ 'core/image' ],\n\t\t\ttransform: ( attributes ) => {\n\t\t\t\t// Init the align and size from the first item which may be either the placeholder or an image.\n\t\t\t\tlet { align, sizeSlug } = attributes[ 0 ];\n\t\t\t\t// Loop through all the images and check if they have the same align and size.\n\t\t\t\talign = every( attributes, [ 'align', align ] )\n\t\t\t\t\t? align\n\t\t\t\t\t: undefined;\n\t\t\t\tsizeSlug = every( attributes, [ 'sizeSlug', sizeSlug ] )\n\t\t\t\t\t? sizeSlug\n\t\t\t\t\t: undefined;\n\n\t\t\t\tconst validImages = filter( attributes, ( { url } ) => url );\n\n\t\t\t\treturn createBlock( 'core/gallery', {\n\t\t\t\t\timages: validImages.map(\n\t\t\t\t\t\t( { id, url, alt, caption } ) => ( {\n\t\t\t\t\t\t\tid: toString( id ),\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\talt,\n\t\t\t\t\t\t\tcaption,\n\t\t\t\t\t\t} )\n\t\t\t\t\t),\n\t\t\t\t\tids: validImages.map( ( { id } ) => parseInt( id, 10 ) ),\n\t\t\t\t\talign,\n\t\t\t\t\tsizeSlug,\n\t\t\t\t} );\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttype: 'shortcode',\n\t\t\ttag: 'gallery',\n\t\t\tattributes: {\n\t\t\t\timages: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tshortcode: ( { named: { ids } } ) => {\n\t\t\t\t\t\treturn parseShortcodeIds( ids ).map( ( id ) => ( {\n\t\t\t\t\t\t\tid: toString( id ),\n\t\t\t\t\t\t} ) );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tids: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\tshortcode: ( { named: { ids } } ) => {\n\t\t\t\t\t\treturn parseShortcodeIds( ids );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tcolumns: {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tshortcode: ( { named: { columns = '3' } } ) => {\n\t\t\t\t\t\treturn parseInt( columns, 10 );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tlinkTo: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tshortcode: ( {\n\t\t\t\t\t\tnamed: { link = LINK_DESTINATION_ATTACHMENT },\n\t\t\t\t\t} ) => {\n\t\t\t\t\t\treturn link;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tisMatch( { named } ) {\n\t\t\t\treturn undefined !== named.ids;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\t// When created by drag and dropping multiple files on an insertion point\n\t\t\ttype: 'files',\n\t\t\tisMatch( files ) {\n\t\t\t\treturn (\n\t\t\t\t\tfiles.length !== 1 &&\n\t\t\t\t\tevery(\n\t\t\t\t\t\tfiles,\n\t\t\t\t\t\t( file ) => file.type.indexOf( 'image/' ) === 0\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t},\n\t\t\ttransform( files ) {\n\t\t\t\tconst block = createBlock( 'core/gallery', {\n\t\t\t\t\timages: files.map( ( file ) =>\n\t\t\t\t\t\tpickRelevantMediaFiles( {\n\t\t\t\t\t\t\turl: createBlobURL( file ),\n\t\t\t\t\t\t} )\n\t\t\t\t\t),\n\t\t\t\t} );\n\t\t\t\treturn block;\n\t\t\t},\n\t\t},\n\t],\n\tto: [\n\t\t{\n\t\t\ttype: 'block',\n\t\t\tblocks: [ 'core/image' ],\n\t\t\ttransform: ( { images, align, sizeSlug, ids } ) => {\n\t\t\t\tif ( images.length > 0 ) {\n\t\t\t\t\treturn images.map( ( { url, alt, caption }, index ) =>\n\t\t\t\t\t\tcreateBlock( 'core/image', {\n\t\t\t\t\t\t\tid: ids[ index ],\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\talt,\n\t\t\t\t\t\t\tcaption,\n\t\t\t\t\t\t\talign,\n\t\t\t\t\t\t\tsizeSlug,\n\t\t\t\t\t\t} )\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn createBlock( 'core/image', { align } );\n\t\t\t},\n\t\t},\n\t],\n};\n\nexport default transforms;\n"]}