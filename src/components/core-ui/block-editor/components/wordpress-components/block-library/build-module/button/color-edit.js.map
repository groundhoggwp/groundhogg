{"version":3,"sources":["@wordpress/block-library/src/button/color-edit.js"],"names":["pickBy","isEqual","isObject","identity","mapValues","__","useState","useEffect","useRef","Platform","getColorObjectByColorValue","getColorObjectByAttributeValues","getGradientValueBySlug","getGradientSlugByValue","__experimentalPanelColorGradientSettings","PanelColorGradientSettings","ContrastChecker","InspectorControls","__experimentalUseEditorFeature","useEditorFeature","EMPTY_ARRAY","isWebPlatform","OS","getComputedStyle","node","ownerDocument","defaultView","getBlockDOMNode","clientId","document","getElementById","cleanEmptyObject","object","cleanedNestedObjects","undefined","ColorPanel","settings","enableContrastChecking","detectedBackgroundColor","setDetectedBackgroundColor","detectedColor","setDetectedColor","title","colorsDetectionElement","color","backgroundColorNode","backgroundColor","parentNode","nodeType","ELEMENT_NODE","ColorEdit","props","attributes","colors","gradients","localAttributes","current","style","textColor","gradient","gradientValue","onChangeColor","name","value","colorObject","attributeName","newStyle","slug","newNamedColor","newAttributes","setAttributes","onChangeGradient","label","onColorChange","colorValue","text","background","onGradientChange"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { pickBy, isEqual, isObject, identity, mapValues } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useState, useEffect, useRef, Platform } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgetColorObjectByColorValue,\n\tgetColorObjectByAttributeValues,\n\tgetGradientValueBySlug,\n\tgetGradientSlugByValue,\n\t__experimentalPanelColorGradientSettings as PanelColorGradientSettings,\n\tContrastChecker,\n\tInspectorControls,\n\t__experimentalUseEditorFeature as useEditorFeature,\n} from '@wordpress/block-editor';\n\nconst EMPTY_ARRAY = [];\n\nconst isWebPlatform = Platform.OS === 'web';\n\nfunction getComputedStyle( node ) {\n\treturn node.ownerDocument.defaultView.getComputedStyle( node );\n}\n\n// The code in this file is copied entirely from the \"color\" and \"style\" support flags\n// The flag can't be used at the moment because of the extra wrapper around\n// the button block markup.\n\nfunction getBlockDOMNode( clientId ) {\n\treturn document.getElementById( 'block-' + clientId );\n}\n\n/**\n * Removed undefined values from nested object.\n *\n * @param {*} object\n * @return {*} Object cleaned from undefined values\n */\nconst cleanEmptyObject = ( object ) => {\n\tif ( ! isObject( object ) ) {\n\t\treturn object;\n\t}\n\tconst cleanedNestedObjects = pickBy(\n\t\tmapValues( object, cleanEmptyObject ),\n\t\tidentity\n\t);\n\treturn isEqual( cleanedNestedObjects, {} )\n\t\t? undefined\n\t\t: cleanedNestedObjects;\n};\n\nfunction ColorPanel( { settings, clientId, enableContrastChecking = true } ) {\n\tconst [ detectedBackgroundColor, setDetectedBackgroundColor ] = useState();\n\tconst [ detectedColor, setDetectedColor ] = useState();\n\n\tconst title = isWebPlatform\n\t\t? __( 'Color settings' )\n\t\t: __( 'Color Settings' );\n\n\tuseEffect( () => {\n\t\tif ( isWebPlatform && ! enableContrastChecking ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst colorsDetectionElement = getBlockDOMNode( clientId );\n\t\tif ( ! colorsDetectionElement ) {\n\t\t\treturn;\n\t\t}\n\t\tsetDetectedColor( getComputedStyle( colorsDetectionElement ).color );\n\n\t\tlet backgroundColorNode = colorsDetectionElement;\n\t\tlet backgroundColor = getComputedStyle( backgroundColorNode )\n\t\t\t.backgroundColor;\n\t\twhile (\n\t\t\tbackgroundColor === 'rgba(0, 0, 0, 0)' &&\n\t\t\tbackgroundColorNode.parentNode &&\n\t\t\tbackgroundColorNode.parentNode.nodeType ===\n\t\t\t\tbackgroundColorNode.parentNode.ELEMENT_NODE\n\t\t) {\n\t\t\tbackgroundColorNode = backgroundColorNode.parentNode;\n\t\t\tbackgroundColor = getComputedStyle( backgroundColorNode )\n\t\t\t\t.backgroundColor;\n\t\t}\n\n\t\tsetDetectedBackgroundColor( backgroundColor );\n\t} );\n\n\treturn (\n\t\t<InspectorControls>\n\t\t\t<PanelColorGradientSettings\n\t\t\t\ttitle={ title }\n\t\t\t\tinitialOpen={ false }\n\t\t\t\tsettings={ settings }\n\t\t\t>\n\t\t\t\t{ isWebPlatform && enableContrastChecking && (\n\t\t\t\t\t<ContrastChecker\n\t\t\t\t\t\tbackgroundColor={ detectedBackgroundColor }\n\t\t\t\t\t\ttextColor={ detectedColor }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</PanelColorGradientSettings>\n\t\t</InspectorControls>\n\t);\n}\n\n/**\n * Inspector control panel containing the color related configuration\n *\n * @param {Object} props\n *\n * @return {WPElement} Color edit element.\n */\nfunction ColorEdit( props ) {\n\tconst { attributes } = props;\n\tconst colors = useEditorFeature( 'color.palette' ) || EMPTY_ARRAY;\n\tconst gradients = useEditorFeature( 'color.gradients' ) || EMPTY_ARRAY;\n\n\t// Shouldn't be needed but right now the ColorGradientsPanel\n\t// can trigger both onChangeColor and onChangeBackground\n\t// synchronously causing our two callbacks to override changes\n\t// from each other.\n\tconst localAttributes = useRef( attributes );\n\tuseEffect( () => {\n\t\tlocalAttributes.current = attributes;\n\t}, [ attributes ] );\n\n\tconst { style, textColor, backgroundColor, gradient } = attributes;\n\tlet gradientValue;\n\tif ( gradient ) {\n\t\tgradientValue = getGradientValueBySlug( gradients, gradient );\n\t} else {\n\t\tgradientValue = style?.color?.gradient;\n\t}\n\n\tconst onChangeColor = ( name ) => ( value ) => {\n\t\tconst colorObject = getColorObjectByColorValue( colors, value );\n\t\tconst attributeName = name + 'Color';\n\t\tconst newStyle = {\n\t\t\t...localAttributes.current.style,\n\t\t\tcolor: {\n\t\t\t\t...localAttributes.current?.style?.color,\n\t\t\t\t[ name ]: colorObject?.slug ? undefined : value,\n\t\t\t},\n\t\t};\n\n\t\tconst newNamedColor = colorObject?.slug ? colorObject.slug : undefined;\n\t\tconst newAttributes = {\n\t\t\tstyle: cleanEmptyObject( newStyle ),\n\t\t\t[ attributeName ]: newNamedColor,\n\t\t};\n\n\t\tprops.setAttributes( newAttributes );\n\t\tlocalAttributes.current = {\n\t\t\t...localAttributes.current,\n\t\t\t...newAttributes,\n\t\t};\n\t};\n\n\tconst onChangeGradient = ( value ) => {\n\t\tconst slug = getGradientSlugByValue( gradients, value );\n\t\tlet newAttributes;\n\t\tif ( slug ) {\n\t\t\tconst newStyle = {\n\t\t\t\t...localAttributes.current?.style,\n\t\t\t\tcolor: {\n\t\t\t\t\t...localAttributes.current?.style?.color,\n\t\t\t\t\tgradient: undefined,\n\t\t\t\t},\n\t\t\t};\n\t\t\tnewAttributes = {\n\t\t\t\tstyle: cleanEmptyObject( newStyle ),\n\t\t\t\tgradient: slug,\n\t\t\t};\n\t\t} else {\n\t\t\tconst newStyle = {\n\t\t\t\t...localAttributes.current?.style,\n\t\t\t\tcolor: {\n\t\t\t\t\t...localAttributes.current?.style?.color,\n\t\t\t\t\tgradient: value,\n\t\t\t\t},\n\t\t\t};\n\t\t\tnewAttributes = {\n\t\t\t\tstyle: cleanEmptyObject( newStyle ),\n\t\t\t\tgradient: undefined,\n\t\t\t};\n\t\t}\n\t\tprops.setAttributes( newAttributes );\n\t\tlocalAttributes.current = {\n\t\t\t...localAttributes.current,\n\t\t\t...newAttributes,\n\t\t};\n\t};\n\n\treturn (\n\t\t<ColorPanel\n\t\t\tenableContrastChecking={ ! gradient && ! style?.color?.gradient }\n\t\t\tclientId={ props.clientId }\n\t\t\tsettings={ [\n\t\t\t\t{\n\t\t\t\t\tlabel: __( 'Text Color' ),\n\t\t\t\t\tonColorChange: onChangeColor( 'text' ),\n\t\t\t\t\tcolorValue: getColorObjectByAttributeValues(\n\t\t\t\t\t\tcolors,\n\t\t\t\t\t\ttextColor,\n\t\t\t\t\t\tstyle?.color?.text\n\t\t\t\t\t).color,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __( 'Background Color' ),\n\t\t\t\t\tonColorChange: onChangeColor( 'background' ),\n\t\t\t\t\tcolorValue: getColorObjectByAttributeValues(\n\t\t\t\t\t\tcolors,\n\t\t\t\t\t\tbackgroundColor,\n\t\t\t\t\t\tstyle?.color?.background\n\t\t\t\t\t).color,\n\t\t\t\t\tgradientValue,\n\t\t\t\t\tonGradientChange: onChangeGradient,\n\t\t\t\t},\n\t\t\t] }\n\t\t/>\n\t);\n}\n\nexport default ColorEdit;\n"]}