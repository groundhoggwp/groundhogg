{"version":3,"sources":["@wordpress/block-editor/src/components/link-control/search-input.js"],"names":["noop","omit","useInstanceId","forwardRef","useState","__","URLInput","LinkControlSearchResults","CREATE_TYPE","useSearchHandler","noopSearchHandler","Promise","resolve","LinkControlSearchInput","ref","value","children","currentLink","className","placeholder","withCreateSuggestion","onCreateSuggestion","onChange","onSelect","showSuggestions","renderSuggestions","props","fetchSuggestions","allowDirectEntry","showInitialSuggestions","suggestionsQuery","withURLSuggestion","createSuggestionButtonText","genericSearchHandler","searchHandler","instanceId","focusedSuggestion","setFocusedSuggestion","onInputChange","selection","suggestion","onFormSubmit","event","preventDefault","onSuggestionSelected","url","handleRenderSuggestions","currentInputValue","handleSuggestionClick","selectedSuggestion","type","title","Object","keys","length"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop, omit } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useInstanceId } from '@wordpress/compose';\nimport { forwardRef, useState } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { URLInput } from '../';\nimport LinkControlSearchResults from './search-results';\nimport { CREATE_TYPE } from './constants';\nimport useSearchHandler from './use-search-handler';\n\nconst noopSearchHandler = Promise.resolve( [] );\nconst LinkControlSearchInput = forwardRef(\n\t(\n\t\t{\n\t\t\tvalue,\n\t\t\tchildren,\n\t\t\tcurrentLink = {},\n\t\t\tclassName = null,\n\t\t\tplaceholder = null,\n\t\t\twithCreateSuggestion = false,\n\t\t\tonCreateSuggestion = noop,\n\t\t\tonChange = noop,\n\t\t\tonSelect = noop,\n\t\t\tshowSuggestions = true,\n\t\t\trenderSuggestions = ( props ) => (\n\t\t\t\t<LinkControlSearchResults { ...props } />\n\t\t\t),\n\t\t\tfetchSuggestions = null,\n\t\t\tallowDirectEntry = true,\n\t\t\tshowInitialSuggestions = false,\n\t\t\tsuggestionsQuery = {},\n\t\t\twithURLSuggestion = true,\n\t\t\tcreateSuggestionButtonText,\n\t\t},\n\t\tref\n\t) => {\n\t\tconst genericSearchHandler = useSearchHandler(\n\t\t\tsuggestionsQuery,\n\t\t\tallowDirectEntry,\n\t\t\twithCreateSuggestion,\n\t\t\twithURLSuggestion\n\t\t);\n\t\tconst searchHandler = showSuggestions\n\t\t\t? fetchSuggestions || genericSearchHandler\n\t\t\t: noopSearchHandler;\n\n\t\tconst instanceId = useInstanceId( LinkControlSearchInput );\n\t\tconst [ focusedSuggestion, setFocusedSuggestion ] = useState();\n\n\t\t/**\n\t\t * Handles the user moving between different suggestions. Does not handle\n\t\t * choosing an individual item.\n\t\t *\n\t\t * @param {string} selection the url of the selected suggestion.\n\t\t * @param {Object} suggestion the suggestion object.\n\t\t */\n\t\tconst onInputChange = ( selection, suggestion ) => {\n\t\t\tonChange( selection );\n\t\t\tsetFocusedSuggestion( suggestion );\n\t\t};\n\n\t\tconst onFormSubmit = ( event ) => {\n\t\t\tevent.preventDefault();\n\t\t\tonSuggestionSelected( focusedSuggestion || { url: value } );\n\t\t};\n\n\t\tconst handleRenderSuggestions = ( props ) =>\n\t\t\trenderSuggestions( {\n\t\t\t\t...props,\n\t\t\t\tinstanceId,\n\t\t\t\twithCreateSuggestion,\n\t\t\t\tcurrentInputValue: value,\n\t\t\t\tcreateSuggestionButtonText,\n\t\t\t\tsuggestionsQuery,\n\t\t\t\thandleSuggestionClick: ( suggestion ) => {\n\t\t\t\t\tif ( props.handleSuggestionClick ) {\n\t\t\t\t\t\tprops.handleSuggestionClick( suggestion );\n\t\t\t\t\t}\n\t\t\t\t\tonSuggestionSelected( suggestion );\n\t\t\t\t},\n\t\t\t} );\n\n\t\tconst onSuggestionSelected = async ( selectedSuggestion ) => {\n\t\t\tlet suggestion = selectedSuggestion;\n\t\t\tif ( CREATE_TYPE === selectedSuggestion.type ) {\n\t\t\t\t// Create a new page and call onSelect with the output from the onCreateSuggestion callback\n\t\t\t\ttry {\n\t\t\t\t\tsuggestion = await onCreateSuggestion(\n\t\t\t\t\t\tselectedSuggestion.title\n\t\t\t\t\t);\n\t\t\t\t\tif ( suggestion?.url ) {\n\t\t\t\t\t\tonSelect( suggestion );\n\t\t\t\t\t}\n\t\t\t\t} catch ( e ) {}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tallowDirectEntry ||\n\t\t\t\t( suggestion && Object.keys( suggestion ).length >= 1 )\n\t\t\t) {\n\t\t\t\tonSelect(\n\t\t\t\t\t// Some direct entries don't have types or IDs, and we still need to clear the previous ones.\n\t\t\t\t\t{ ...omit( currentLink, 'id', 'url' ), ...suggestion },\n\t\t\t\t\tsuggestion\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\treturn (\n\t\t\t<form onSubmit={ onFormSubmit }>\n\t\t\t\t<URLInput\n\t\t\t\t\tclassName={ className }\n\t\t\t\t\tvalue={ value }\n\t\t\t\t\tonChange={ onInputChange }\n\t\t\t\t\tplaceholder={ placeholder ?? __( 'Search or type url' ) }\n\t\t\t\t\t__experimentalRenderSuggestions={\n\t\t\t\t\t\tshowSuggestions ? handleRenderSuggestions : null\n\t\t\t\t\t}\n\t\t\t\t\t__experimentalFetchLinkSuggestions={ searchHandler }\n\t\t\t\t\t__experimentalHandleURLSuggestions={ true }\n\t\t\t\t\t__experimentalShowInitialSuggestions={\n\t\t\t\t\t\tshowInitialSuggestions\n\t\t\t\t\t}\n\t\t\t\t\tref={ ref }\n\t\t\t\t/>\n\t\t\t\t{ children }\n\t\t\t</form>\n\t\t);\n\t}\n);\n\nexport default LinkControlSearchInput;\n"]}