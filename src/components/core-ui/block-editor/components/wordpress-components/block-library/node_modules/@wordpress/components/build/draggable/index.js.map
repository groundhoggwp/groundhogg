{"version":3,"sources":["@wordpress/components/src/draggable/index.js"],"names":["dragImageClass","cloneWrapperClass","cloneHeightTransformationBreakpoint","clonePadding","Draggable","arguments","onDragStart","bind","onDragOver","onDragEnd","resetDragState","dragComponentRef","event","props","noop","preventDefault","persist","setTimeout","cloneWrapper","style","top","parseInt","clientY","cursorTop","left","clientX","cursorLeft","cloneClassname","elementId","transferData","element","document","getElementById","dataTransfer","setDragImage","dragImage","createElement","id","classList","add","body","appendChild","removeChild","setData","JSON","stringify","elementRect","getBoundingClientRect","elementWrapper","parentNode","elementTopOffset","elementLeftOffset","width","current","clonedDragComponent","innerHTML","clone","cloneNode","height","transform","transformOrigin","Array","from","querySelectorAll","forEach","child","addEventListener","removeEventListener","remove","children","dragComponent","__experimentalDragComponent","onDraggableStart","onDraggableEnd","display","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component, createRef } from '@wordpress/element';\nimport { withSafeTimeout } from '@wordpress/compose';\n\nconst dragImageClass = 'components-draggable__invisible-drag-image';\nconst cloneWrapperClass = 'components-draggable__clone';\nconst cloneHeightTransformationBreakpoint = 700;\nconst clonePadding = 0;\n\nclass Draggable extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onDragStart = this.onDragStart.bind( this );\n\t\tthis.onDragOver = this.onDragOver.bind( this );\n\t\tthis.onDragEnd = this.onDragEnd.bind( this );\n\t\tthis.resetDragState = this.resetDragState.bind( this );\n\t\tthis.dragComponentRef = createRef();\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.resetDragState();\n\t}\n\n\t/**\n\t * Removes the element clone, resets cursor, and removes drag listener.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragEnd( event ) {\n\t\tconst { onDragEnd = noop } = this.props;\n\t\tevent.preventDefault();\n\n\t\tthis.resetDragState();\n\n\t\t// Allow the Synthetic Event to be accessed from asynchronous code.\n\t\t// https://reactjs.org/docs/events.html#event-pooling\n\t\tevent.persist();\n\t\tthis.props.setTimeout( onDragEnd.bind( this, event ) );\n\t}\n\n\t/**\n\t * Updates positioning of element clone based on mouse movement during dragging.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragOver( event ) {\n\t\tthis.cloneWrapper.style.top = `${\n\t\t\tparseInt( this.cloneWrapper.style.top, 10 ) +\n\t\t\tevent.clientY -\n\t\t\tthis.cursorTop\n\t\t}px`;\n\t\tthis.cloneWrapper.style.left = `${\n\t\t\tparseInt( this.cloneWrapper.style.left, 10 ) +\n\t\t\tevent.clientX -\n\t\t\tthis.cursorLeft\n\t\t}px`;\n\n\t\t// Update cursor coordinates.\n\t\tthis.cursorLeft = event.clientX;\n\t\tthis.cursorTop = event.clientY;\n\n\t\tconst { onDragOver = noop } = this.props;\n\n\t\t// The `event` from `onDragOver` is not a SyntheticEvent\n\t\t// and so it doesn't require `event.persist()`.\n\t\tthis.props.setTimeout( onDragOver.bind( this, event ) );\n\t}\n\n\t/**\n\t * This method does a couple of things:\n\t *\n\t * - Clones the current element and spawns clone over original element.\n\t * - Adds a fake temporary drag image to avoid browser defaults.\n\t * - Sets transfer data.\n\t * - Adds dragover listener.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragStart( event ) {\n\t\tconst {\n\t\t\tcloneClassname,\n\t\t\telementId,\n\t\t\ttransferData,\n\t\t\tonDragStart = noop,\n\t\t} = this.props;\n\t\tconst element = document.getElementById( elementId );\n\t\tif ( ! element ) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t// Set a fake drag image to avoid browser defaults. Remove from DOM\n\t\t// right after. event.dataTransfer.setDragImage is not supported yet in\n\t\t// IE, we need to check for its existence first.\n\t\tif ( 'function' === typeof event.dataTransfer.setDragImage ) {\n\t\t\tconst dragImage = document.createElement( 'div' );\n\t\t\tdragImage.id = `drag-image-${ elementId }`;\n\t\t\tdragImage.classList.add( dragImageClass );\n\t\t\tdocument.body.appendChild( dragImage );\n\t\t\tevent.dataTransfer.setDragImage( dragImage, 0, 0 );\n\t\t\tthis.props.setTimeout( () => {\n\t\t\t\tdocument.body.removeChild( dragImage );\n\t\t\t} );\n\t\t}\n\n\t\tevent.dataTransfer.setData( 'text', JSON.stringify( transferData ) );\n\n\t\t// Prepare element clone and append to element wrapper.\n\t\tconst elementRect = element.getBoundingClientRect();\n\t\tconst elementWrapper = element.parentNode;\n\t\tconst elementTopOffset = parseInt( elementRect.top, 10 );\n\t\tconst elementLeftOffset = parseInt( elementRect.left, 10 );\n\t\tthis.cloneWrapper = document.createElement( 'div' );\n\t\tthis.cloneWrapper.classList.add( cloneWrapperClass );\n\t\tif ( cloneClassname ) {\n\t\t\tthis.cloneWrapper.classList.add( cloneClassname );\n\t\t}\n\n\t\tthis.cloneWrapper.style.width = `${\n\t\t\telementRect.width + clonePadding * 2\n\t\t}px`;\n\n\t\t// If a dragComponent is defined, the following logic will clone the\n\t\t// HTML node and inject it into the cloneWrapper.\n\t\tif ( this.dragComponentRef.current ) {\n\t\t\t// Position dragComponent at the same position as the cursor.\n\t\t\tthis.cloneWrapper.style.top = `${ event.clientY }px`;\n\t\t\tthis.cloneWrapper.style.left = `${ event.clientX }px`;\n\n\t\t\tconst clonedDragComponent = document.createElement( 'div' );\n\t\t\tclonedDragComponent.innerHTML = this.dragComponentRef.current.innerHTML;\n\t\t\tthis.cloneWrapper.appendChild( clonedDragComponent );\n\t\t} else {\n\t\t\tconst clone = element.cloneNode( true );\n\t\t\tclone.id = `clone-${ elementId }`;\n\n\t\t\tif ( elementRect.height > cloneHeightTransformationBreakpoint ) {\n\t\t\t\t// Scale down clone if original element is larger than 700px.\n\t\t\t\tthis.cloneWrapper.style.transform = 'scale(0.5)';\n\t\t\t\tthis.cloneWrapper.style.transformOrigin = 'top left';\n\t\t\t\t// Position clone near the cursor.\n\t\t\t\tthis.cloneWrapper.style.top = `${ event.clientY - 100 }px`;\n\t\t\t\tthis.cloneWrapper.style.left = `${ event.clientX }px`;\n\t\t\t} else {\n\t\t\t\t// Position clone right over the original element (20px padding).\n\t\t\t\tthis.cloneWrapper.style.top = `${\n\t\t\t\t\telementTopOffset - clonePadding\n\t\t\t\t}px`;\n\t\t\t\tthis.cloneWrapper.style.left = `${\n\t\t\t\t\telementLeftOffset - clonePadding\n\t\t\t\t}px`;\n\t\t\t}\n\n\t\t\t// Hack: Remove iFrames as it's causing the embeds drag clone to freeze\n\t\t\tArray.from(\n\t\t\t\tclone.querySelectorAll( 'iframe' )\n\t\t\t).forEach( ( child ) => child.parentNode.removeChild( child ) );\n\n\t\t\tthis.cloneWrapper.appendChild( clone );\n\t\t}\n\n\t\t// Inject the cloneWrapper into the DOM.\n\t\telementWrapper.appendChild( this.cloneWrapper );\n\n\t\t// Mark the current cursor coordinates.\n\t\tthis.cursorLeft = event.clientX;\n\t\tthis.cursorTop = event.clientY;\n\t\t// Update cursor to 'grabbing', document wide.\n\t\tdocument.body.classList.add( 'is-dragging-components-draggable' );\n\t\tdocument.addEventListener( 'dragover', this.onDragOver );\n\n\t\t// Allow the Synthetic Event to be accessed from asynchronous code.\n\t\t// https://reactjs.org/docs/events.html#event-pooling\n\t\tevent.persist();\n\t\tthis.props.setTimeout( onDragStart.bind( this, event ) );\n\t}\n\n\t/**\n\t * Cleans up drag state when drag has completed, or component unmounts\n\t * while dragging.\n\t */\n\tresetDragState() {\n\t\t// Remove drag clone\n\t\tdocument.removeEventListener( 'dragover', this.onDragOver );\n\t\tif ( this.cloneWrapper && this.cloneWrapper.parentNode ) {\n\t\t\tthis.cloneWrapper.parentNode.removeChild( this.cloneWrapper );\n\t\t\tthis.cloneWrapper = null;\n\t\t}\n\n\t\tthis.cursorLeft = null;\n\t\tthis.cursorTop = null;\n\n\t\t// Reset cursor.\n\t\tdocument.body.classList.remove( 'is-dragging-components-draggable' );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t\t__experimentalDragComponent: dragComponent,\n\t\t} = this.props;\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ children( {\n\t\t\t\t\tonDraggableStart: this.onDragStart,\n\t\t\t\t\tonDraggableEnd: this.onDragEnd,\n\t\t\t\t} ) }\n\t\t\t\t{ dragComponent && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"components-draggable-drag-component-root\"\n\t\t\t\t\t\tstyle={ { display: 'none' } }\n\t\t\t\t\t\tref={ this.dragComponentRef }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ dragComponent }\n\t\t\t\t\t</div>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default withSafeTimeout( Draggable );\n"]}