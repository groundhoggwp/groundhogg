{"version":3,"sources":["@wordpress/blocks/src/api/raw-handling/normalise-blocks.js"],"names":["isEmpty","isPhrasingContent","normaliseBlocks","HTML","decuDoc","document","implementation","createHTMLDocument","accuDoc","decu","body","accu","innerHTML","firstChild","node","nodeType","TEXT_NODE","nodeValue","trim","removeChild","lastChild","nodeName","appendChild","createElement","ELEMENT_NODE","nextSibling","hasChildNodes"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isEmpty, isPhrasingContent } from '@wordpress/dom';\n\nexport default function normaliseBlocks( HTML ) {\n\tconst decuDoc = document.implementation.createHTMLDocument( '' );\n\tconst accuDoc = document.implementation.createHTMLDocument( '' );\n\n\tconst decu = decuDoc.body;\n\tconst accu = accuDoc.body;\n\n\tdecu.innerHTML = HTML;\n\n\twhile ( decu.firstChild ) {\n\t\tconst node = decu.firstChild;\n\n\t\t// Text nodes: wrap in a paragraph, or append to previous.\n\t\tif ( node.nodeType === node.TEXT_NODE ) {\n\t\t\tif ( ! node.nodeValue.trim() ) {\n\t\t\t\tdecu.removeChild( node );\n\t\t\t} else {\n\t\t\t\tif ( ! accu.lastChild || accu.lastChild.nodeName !== 'P' ) {\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\n\t\t\t\t}\n\n\t\t\t\taccu.lastChild.appendChild( node );\n\t\t\t}\n\t\t\t// Element nodes.\n\t\t} else if ( node.nodeType === node.ELEMENT_NODE ) {\n\t\t\t// BR nodes: create a new paragraph on double, or append to previous.\n\t\t\tif ( node.nodeName === 'BR' ) {\n\t\t\t\tif ( node.nextSibling && node.nextSibling.nodeName === 'BR' ) {\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\n\t\t\t\t\tdecu.removeChild( node.nextSibling );\n\t\t\t\t}\n\n\t\t\t\t// Don't append to an empty paragraph.\n\t\t\t\tif (\n\t\t\t\t\taccu.lastChild &&\n\t\t\t\t\taccu.lastChild.nodeName === 'P' &&\n\t\t\t\t\taccu.lastChild.hasChildNodes()\n\t\t\t\t) {\n\t\t\t\t\taccu.lastChild.appendChild( node );\n\t\t\t\t} else {\n\t\t\t\t\tdecu.removeChild( node );\n\t\t\t\t}\n\t\t\t} else if ( node.nodeName === 'P' ) {\n\t\t\t\t// Only append non-empty paragraph nodes.\n\t\t\t\tif ( isEmpty( node ) ) {\n\t\t\t\t\tdecu.removeChild( node );\n\t\t\t\t} else {\n\t\t\t\t\taccu.appendChild( node );\n\t\t\t\t}\n\t\t\t} else if ( isPhrasingContent( node ) ) {\n\t\t\t\tif ( ! accu.lastChild || accu.lastChild.nodeName !== 'P' ) {\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\n\t\t\t\t}\n\t\t\t\taccu.lastChild.appendChild( node );\n\t\t\t} else {\n\t\t\t\taccu.appendChild( node );\n\t\t\t}\n\t\t} else {\n\t\t\tdecu.removeChild( node );\n\t\t}\n\t}\n\n\treturn accu.innerHTML;\n}\n"]}