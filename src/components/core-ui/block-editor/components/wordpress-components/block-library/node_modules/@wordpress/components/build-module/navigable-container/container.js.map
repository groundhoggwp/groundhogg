{"version":3,"sources":["@wordpress/components/src/navigable-container/container.js"],"names":["omit","noop","isFunction","Component","forwardRef","focus","MENU_ITEM_ROLES","cycleValue","value","total","offset","nextValue","NavigableContainer","arguments","onKeyDown","bind","bindContainer","getFocusableContext","getFocusableIndex","container","addEventListener","onFocus","removeEventListener","ref","forwardedRef","props","current","target","onlyBrowserTabstops","finder","tabbable","focusable","focusables","find","index","directIndex","indexOf","event","cycle","eventToOffset","onNavigate","stopNavigationEvents","undefined","stopImmediatePropagation","targetRole","getAttribute","includes","preventDefault","context","ownerDocument","activeElement","nextIndex","length","children","forwardedNavigableContainer","displayName"],"mappings":";;;;;;;;;;;;;;AAAA;;;AAGA,SAASA,IAAT,EAAeC,IAAf,EAAqBC,UAArB,QAAuC,QAAvC;AAEA;;;;AAGA,SAASC,SAAT,EAAoBC,UAApB,QAAsC,oBAAtC;AACA,SAASC,KAAT,QAAsB,gBAAtB;AAEA,IAAMC,eAAe,GAAG,CAAE,UAAF,EAAc,eAAd,EAA+B,kBAA/B,CAAxB;;AAEA,SAASC,UAAT,CAAqBC,KAArB,EAA4BC,KAA5B,EAAmCC,MAAnC,EAA4C;AAC3C,MAAMC,SAAS,GAAGH,KAAK,GAAGE,MAA1B;;AACA,MAAKC,SAAS,GAAG,CAAjB,EAAqB;AACpB,WAAOF,KAAK,GAAGE,SAAf;AACA,GAFD,MAEO,IAAKA,SAAS,IAAIF,KAAlB,EAA0B;AAChC,WAAOE,SAAS,GAAGF,KAAnB;AACA;;AAED,SAAOE,SAAP;AACA;;IAEKC,kB;;;;;AACL,gCAAc;AAAA;;AAAA;;AACb,+BAAUC,SAAV;AACA,UAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,+BAAjB;AACA,UAAKC,aAAL,GAAqB,MAAKA,aAAL,CAAmBD,IAAnB,+BAArB;AAEA,UAAKE,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBF,IAAzB,+BAA3B;AACA,UAAKG,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBH,IAAvB,+BAAzB;AANa;AAOb;;;;wCAEmB;AACnB;AACA;AACA;AACA;AACA;AACA,WAAKI,SAAL,CAAeC,gBAAf,CAAiC,SAAjC,EAA4C,KAAKN,SAAjD;AACA,WAAKK,SAAL,CAAeC,gBAAf,CAAiC,OAAjC,EAA0C,KAAKC,OAA/C;AACA;;;2CAEsB;AACtB,WAAKF,SAAL,CAAeG,mBAAf,CAAoC,SAApC,EAA+C,KAAKR,SAApD;AACA,WAAKK,SAAL,CAAeG,mBAAf,CAAoC,OAApC,EAA6C,KAAKD,OAAlD;AACA;;;kCAEcE,G,EAAM;AAAA,UACZC,YADY,GACK,KAAKC,KADV,CACZD,YADY;AAEpB,WAAKL,SAAL,GAAiBI,GAAjB;;AAEA,UAAKrB,UAAU,CAAEsB,YAAF,CAAf,EAAkC;AACjCA,QAAAA,YAAY,CAAED,GAAF,CAAZ;AACA,OAFD,MAEO,IAAKC,YAAY,IAAI,aAAaA,YAAlC,EAAiD;AACvDA,QAAAA,YAAY,CAACE,OAAb,GAAuBH,GAAvB;AACA;AACD;;;wCAEoBI,M,EAAS;AAAA,UACrBC,mBADqB,GACG,KAAKH,KADR,CACrBG,mBADqB;AAE7B,UAAMC,MAAM,GAAGD,mBAAmB,GAAGvB,KAAK,CAACyB,QAAT,GAAoBzB,KAAK,CAAC0B,SAA5D;AACA,UAAMC,UAAU,GAAGH,MAAM,CAACI,IAAP,CAAa,KAAKd,SAAlB,CAAnB;AAEA,UAAMe,KAAK,GAAG,KAAKhB,iBAAL,CAAwBc,UAAxB,EAAoCL,MAApC,CAAd;;AACA,UAAKO,KAAK,GAAG,CAAC,CAAT,IAAcP,MAAnB,EAA4B;AAC3B,eAAO;AAAEO,UAAAA,KAAK,EAALA,KAAF;AAASP,UAAAA,MAAM,EAANA,MAAT;AAAiBK,UAAAA,UAAU,EAAVA;AAAjB,SAAP;AACA;;AACD,aAAO,IAAP;AACA;;;sCAEkBA,U,EAAYL,M,EAAS;AACvC,UAAMQ,WAAW,GAAGH,UAAU,CAACI,OAAX,CAAoBT,MAApB,CAApB;;AACA,UAAKQ,WAAW,KAAK,CAAC,CAAtB,EAA0B;AACzB,eAAOA,WAAP;AACA;AACD;;;8BAEUE,K,EAAQ;AAClB,UAAK,KAAKZ,KAAL,CAAWX,SAAhB,EAA4B;AAC3B,aAAKW,KAAL,CAAWX,SAAX,CAAsBuB,KAAtB;AACA;;AAHiB,UAKVpB,mBALU,GAKc,IALd,CAKVA,mBALU;AAAA,wBAWd,KAAKQ,KAXS;AAAA,0CAOjBa,KAPiB;AAAA,UAOjBA,KAPiB,kCAOT,IAPS;AAAA,UAQjBC,aARiB,eAQjBA,aARiB;AAAA,8CASjBC,UATiB;AAAA,UASjBA,UATiB,sCASJvC,IATI;AAAA,UAUjBwC,oBAViB,eAUjBA,oBAViB;AAalB,UAAM/B,MAAM,GAAG6B,aAAa,CAAEF,KAAF,CAA5B,CAbkB,CAelB;;AACA,UAAK3B,MAAM,KAAKgC,SAAX,IAAwBD,oBAA7B,EAAoD;AACnD;AACAJ,QAAAA,KAAK,CAACM,wBAAN,GAFmD,CAInD;AACA;AACA;AACA;;AACA,YAAMC,UAAU,GAAGP,KAAK,CAACV,MAAN,CAAakB,YAAb,CAA2B,MAA3B,CAAnB;;AACA,YAAKvC,eAAe,CAACwC,QAAhB,CAA0BF,UAA1B,CAAL,EAA8C;AAC7CP,UAAAA,KAAK,CAACU,cAAN;AACA;AACD;;AAED,UAAK,CAAErC,MAAP,EAAgB;AACf;AACA;;AAED,UAAMsC,OAAO,GAAG/B,mBAAmB,CAClCoB,KAAK,CAACV,MAAN,CAAasB,aAAb,CAA2BC,aADO,CAAnC;;AAGA,UAAK,CAAEF,OAAP,EAAiB;AAChB;AACA;;AAvCiB,UAyCVd,KAzCU,GAyCYc,OAzCZ,CAyCVd,KAzCU;AAAA,UAyCHF,UAzCG,GAyCYgB,OAzCZ,CAyCHhB,UAzCG;AA0ClB,UAAMmB,SAAS,GAAGb,KAAK,GACpB/B,UAAU,CAAE2B,KAAF,EAASF,UAAU,CAACoB,MAApB,EAA4B1C,MAA5B,CADU,GAEpBwB,KAAK,GAAGxB,MAFX;;AAGA,UAAKyC,SAAS,IAAI,CAAb,IAAkBA,SAAS,GAAGnB,UAAU,CAACoB,MAA9C,EAAuD;AACtDpB,QAAAA,UAAU,CAAEmB,SAAF,CAAV,CAAwB9C,KAAxB;AACAmC,QAAAA,UAAU,CAAEW,SAAF,EAAanB,UAAU,CAAEmB,SAAF,CAAvB,CAAV;AACA;AACD;;;6BAEQ;AAAA,yBACuB,KAAK1B,KAD5B;AAAA,UACA4B,QADA,gBACAA,QADA;AAAA,UACa5B,KADb;;AAER,aACC;AACC,QAAA,GAAG,EAAG,KAAKT;AADZ,SAEMhB,IAAI,CAAEyB,KAAF,EAAS,CACjB,sBADiB,EAEjB,eAFiB,EAGjB,YAHiB,EAIjB,WAJiB,EAKjB,OALiB,EAMjB,qBANiB,EAOjB,cAPiB,CAAT,CAFV,GAYG4B,QAZH,CADD;AAgBA;;;;EA5H+BlD,S;;AA+HjC,IAAMmD,2BAA2B,GAAG,SAA9BA,2BAA8B,CAAE7B,KAAF,EAASF,GAAT,EAAkB;AACrD,SAAO,cAAC,kBAAD,eAAyBE,KAAzB;AAAiC,IAAA,YAAY,EAAGF;AAAhD,KAAP;AACA,CAFD;;AAGA+B,2BAA2B,CAACC,WAA5B,GAA0C,oBAA1C;AAEA,eAAenD,UAAU,CAAEkD,2BAAF,CAAzB","sourcesContent":["/**\n * External dependencies\n */\nimport { omit, noop, isFunction } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component, forwardRef } from '@wordpress/element';\nimport { focus } from '@wordpress/dom';\n\nconst MENU_ITEM_ROLES = [ 'menuitem', 'menuitemradio', 'menuitemcheckbox' ];\n\nfunction cycleValue( value, total, offset ) {\n\tconst nextValue = value + offset;\n\tif ( nextValue < 0 ) {\n\t\treturn total + nextValue;\n\t} else if ( nextValue >= total ) {\n\t\treturn nextValue - total;\n\t}\n\n\treturn nextValue;\n}\n\nclass NavigableContainer extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.bindContainer = this.bindContainer.bind( this );\n\n\t\tthis.getFocusableContext = this.getFocusableContext.bind( this );\n\t\tthis.getFocusableIndex = this.getFocusableIndex.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\t// We use DOM event listeners instead of React event listeners\n\t\t// because we want to catch events from the underlying DOM tree\n\t\t// The React Tree can be different from the DOM tree when using\n\t\t// portals. Block Toolbars for instance are rendered in a separate\n\t\t// React Trees.\n\t\tthis.container.addEventListener( 'keydown', this.onKeyDown );\n\t\tthis.container.addEventListener( 'focus', this.onFocus );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.container.removeEventListener( 'keydown', this.onKeyDown );\n\t\tthis.container.removeEventListener( 'focus', this.onFocus );\n\t}\n\n\tbindContainer( ref ) {\n\t\tconst { forwardedRef } = this.props;\n\t\tthis.container = ref;\n\n\t\tif ( isFunction( forwardedRef ) ) {\n\t\t\tforwardedRef( ref );\n\t\t} else if ( forwardedRef && 'current' in forwardedRef ) {\n\t\t\tforwardedRef.current = ref;\n\t\t}\n\t}\n\n\tgetFocusableContext( target ) {\n\t\tconst { onlyBrowserTabstops } = this.props;\n\t\tconst finder = onlyBrowserTabstops ? focus.tabbable : focus.focusable;\n\t\tconst focusables = finder.find( this.container );\n\n\t\tconst index = this.getFocusableIndex( focusables, target );\n\t\tif ( index > -1 && target ) {\n\t\t\treturn { index, target, focusables };\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetFocusableIndex( focusables, target ) {\n\t\tconst directIndex = focusables.indexOf( target );\n\t\tif ( directIndex !== -1 ) {\n\t\t\treturn directIndex;\n\t\t}\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( this.props.onKeyDown ) {\n\t\t\tthis.props.onKeyDown( event );\n\t\t}\n\n\t\tconst { getFocusableContext } = this;\n\t\tconst {\n\t\t\tcycle = true,\n\t\t\teventToOffset,\n\t\t\tonNavigate = noop,\n\t\t\tstopNavigationEvents,\n\t\t} = this.props;\n\n\t\tconst offset = eventToOffset( event );\n\n\t\t// eventToOffset returns undefined if the event is not handled by the component\n\t\tif ( offset !== undefined && stopNavigationEvents ) {\n\t\t\t// Prevents arrow key handlers bound to the document directly interfering\n\t\t\tevent.stopImmediatePropagation();\n\n\t\t\t// When navigating a collection of items, prevent scroll containers\n\t\t\t// from scrolling. The preventDefault also prevents Voiceover from\n\t\t\t// 'handling' the event, as voiceover will try to use arrow keys\n\t\t\t// for highlighting text.\n\t\t\tconst targetRole = event.target.getAttribute( 'role' );\n\t\t\tif ( MENU_ITEM_ROLES.includes( targetRole ) ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\n\t\tif ( ! offset ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = getFocusableContext(\n\t\t\tevent.target.ownerDocument.activeElement\n\t\t);\n\t\tif ( ! context ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { index, focusables } = context;\n\t\tconst nextIndex = cycle\n\t\t\t? cycleValue( index, focusables.length, offset )\n\t\t\t: index + offset;\n\t\tif ( nextIndex >= 0 && nextIndex < focusables.length ) {\n\t\t\tfocusables[ nextIndex ].focus();\n\t\t\tonNavigate( nextIndex, focusables[ nextIndex ] );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { children, ...props } = this.props;\n\t\treturn (\n\t\t\t<div\n\t\t\t\tref={ this.bindContainer }\n\t\t\t\t{ ...omit( props, [\n\t\t\t\t\t'stopNavigationEvents',\n\t\t\t\t\t'eventToOffset',\n\t\t\t\t\t'onNavigate',\n\t\t\t\t\t'onKeyDown',\n\t\t\t\t\t'cycle',\n\t\t\t\t\t'onlyBrowserTabstops',\n\t\t\t\t\t'forwardedRef',\n\t\t\t\t] ) }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nconst forwardedNavigableContainer = ( props, ref ) => {\n\treturn <NavigableContainer { ...props } forwardedRef={ ref } />;\n};\nforwardedNavigableContainer.displayName = 'NavigableContainer';\n\nexport default forwardRef( forwardedNavigableContainer );\n"]}