{"version":3,"sources":["@wordpress/block-editor/src/components/block-toolbar/utils.js"],"names":["noop","useState","useRef","useEffect","window","clearTimeout","setTimeout","DEBOUNCE_TIMEOUT","useDebouncedShowMovers","ref","isFocused","debounceTimeout","onChange","showMovers","setShowMovers","timeoutRef","handleOnChange","nextIsFocused","current","getIsHovered","matches","shouldHideMovers","isHovered","clearTimeoutRef","timeout","debouncedShowMovers","event","stopPropagation","debouncedHideMovers","useShowMoversGestures","setIsFocused","registerRef","isFocusedWithin","contains","ownerDocument","activeElement","node","handleOnFocus","handleOnBlur","addEventListener","removeEventListener","gestures","onMouseMove","onMouseLeave"],"mappings":";;AAAA;;;AAGA,SAASA,IAAT,QAAqB,QAArB;AAEA;;;;AAGA,SAASC,QAAT,EAAmBC,MAAnB,EAA2BC,SAA3B,QAA4C,oBAA5C;cAEqCC,M;IAA7BC,Y,WAAAA,Y;IAAcC,U,WAAAA,U;AAEtB,IAAMC,gBAAgB,GAAG,GAAzB;AAEA;;;;;;;;;;AASA,OAAO,SAASC,sBAAT,OAKH;AAAA,MAJHC,GAIG,QAJHA,GAIG;AAAA,MAHHC,SAGG,QAHHA,SAGG;AAAA,kCAFHC,eAEG;AAAA,MAFHA,eAEG,qCAFeJ,gBAEf;AAAA,2BADHK,QACG;AAAA,MADHA,QACG,8BADQZ,IACR;;AAAA,kBACmCC,QAAQ,CAAE,KAAF,CAD3C;AAAA;AAAA,MACKY,UADL;AAAA,MACiBC,aADjB;;AAEH,MAAMC,UAAU,GAAGb,MAAM,EAAzB;;AAEA,MAAMc,cAAc,GAAG,SAAjBA,cAAiB,CAAEC,aAAF,EAAqB;AAC3C,QAAKR,GAAL,aAAKA,GAAL,uBAAKA,GAAG,CAAES,OAAV,EAAoB;AACnBJ,MAAAA,aAAa,CAAEG,aAAF,CAAb;AACA;;AAEDL,IAAAA,QAAQ,CAAEK,aAAF,CAAR;AACA,GAND;;AAQA,MAAME,YAAY,GAAG,SAAfA,YAAe,GAAM;AAC1B,WAAO,CAAAV,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAES,OAAL,KAAgBT,GAAG,CAACS,OAAJ,CAAYE,OAAZ,CAAqB,QAArB,CAAvB;AACA,GAFD;;AAIA,MAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAM;AAC9B,QAAMC,SAAS,GAAGH,YAAY,EAA9B;AAEA,WAAO,CAAET,SAAF,IAAe,CAAEY,SAAxB;AACA,GAJD;;AAMA,MAAMC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC7B,QAAMC,OAAO,GAAGT,UAAU,CAACG,OAA3B;;AAEA,QAAKM,OAAO,IAAInB,YAAhB,EAA+B;AAC9BA,MAAAA,YAAY,CAAEmB,OAAF,CAAZ;AACA;AACD,GAND;;AAQA,MAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAEC,KAAF,EAAa;AACxC,QAAKA,KAAL,EAAa;AACZA,MAAAA,KAAK,CAACC,eAAN;AACA;;AAEDJ,IAAAA,eAAe;;AAEf,QAAK,CAAEV,UAAP,EAAoB;AACnBG,MAAAA,cAAc,CAAE,IAAF,CAAd;AACA;AACD,GAVD;;AAYA,MAAMY,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAEF,KAAF,EAAa;AACxC,QAAKA,KAAL,EAAa;AACZA,MAAAA,KAAK,CAACC,eAAN;AACA;;AAEDJ,IAAAA,eAAe;AAEfR,IAAAA,UAAU,CAACG,OAAX,GAAqBZ,UAAU,CAAE,YAAM;AACtC,UAAKe,gBAAgB,EAArB,EAA0B;AACzBL,QAAAA,cAAc,CAAE,KAAF,CAAd;AACA;AACD,KAJ8B,EAI5BL,eAJ4B,CAA/B;AAKA,GAZD;;AAcAR,EAAAA,SAAS,CAAE;AAAA,WAAM;AAAA,aAAMoB,eAAe,EAArB;AAAA,KAAN;AAAA,GAAF,EAAiC,EAAjC,CAAT;AAEA,SAAO;AACNV,IAAAA,UAAU,EAAVA,UADM;AAENY,IAAAA,mBAAmB,EAAnBA,mBAFM;AAGNG,IAAAA,mBAAmB,EAAnBA;AAHM,GAAP;AAKA;AAED;;;;;;;;;;AASA,OAAO,SAASC,qBAAT,QAIH;AAAA,MAHHpB,GAGG,SAHHA,GAGG;AAAA,oCAFHE,eAEG;AAAA,MAFHA,eAEG,sCAFeJ,gBAEf;AAAA,6BADHK,QACG;AAAA,MADHA,QACG,+BADQZ,IACR;;AAAA,mBACiCC,QAAQ,CAAE,KAAF,CADzC;AAAA;AAAA,MACKS,SADL;AAAA,MACgBoB,YADhB;;AAAA,8BAMCtB,sBAAsB,CAAE;AAAEC,IAAAA,GAAG,EAAHA,GAAF;AAAOE,IAAAA,eAAe,EAAfA,eAAP;AAAwBD,IAAAA,SAAS,EAATA,SAAxB;AAAmCE,IAAAA,QAAQ,EAARA;AAAnC,GAAF,CANvB;AAAA,MAGFC,UAHE,yBAGFA,UAHE;AAAA,MAIFY,mBAJE,yBAIFA,mBAJE;AAAA,MAKFG,mBALE,yBAKFA,mBALE;;AAQH,MAAMG,WAAW,GAAG7B,MAAM,CAAE,KAAF,CAA1B;;AAEA,MAAM8B,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC7B,WACC,CAAAvB,GAAG,SAAH,IAAAA,GAAG,WAAH,YAAAA,GAAG,CAAES,OAAL,KACAT,GAAG,CAACS,OAAJ,CAAYe,QAAZ,CAAsBxB,GAAG,CAACS,OAAJ,CAAYgB,aAAZ,CAA0BC,aAAhD,CAFD;AAIA,GALD;;AAOAhC,EAAAA,SAAS,CAAE,YAAM;AAChB,QAAMiC,IAAI,GAAG3B,GAAG,CAACS,OAAjB;;AAEA,QAAMmB,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AAC3B,UAAKL,eAAe,EAApB,EAAyB;AACxBF,QAAAA,YAAY,CAAE,IAAF,CAAZ;AACAL,QAAAA,mBAAmB;AACnB;AACD,KALD;;AAOA,QAAMa,YAAY,GAAG,SAAfA,YAAe,GAAM;AAC1B,UAAK,CAAEN,eAAe,EAAtB,EAA2B;AAC1BF,QAAAA,YAAY,CAAE,KAAF,CAAZ;AACAF,QAAAA,mBAAmB;AACnB;AACD,KALD;AAOA;;;;;;AAIA,QAAKQ,IAAI,IAAI,CAAEL,WAAW,CAACb,OAA3B,EAAqC;AACpCkB,MAAAA,IAAI,CAACG,gBAAL,CAAuB,OAAvB,EAAgCF,aAAhC,EAA+C,IAA/C;AACAD,MAAAA,IAAI,CAACG,gBAAL,CAAuB,MAAvB,EAA+BD,YAA/B,EAA6C,IAA7C;AACAP,MAAAA,WAAW,CAACb,OAAZ,GAAsB,IAAtB;AACA;;AAED,WAAO,YAAM;AACZ,UAAKkB,IAAL,EAAY;AACXA,QAAAA,IAAI,CAACI,mBAAL,CAA0B,OAA1B,EAAmCH,aAAnC;AACAD,QAAAA,IAAI,CAACI,mBAAL,CAA0B,MAA1B,EAAkCF,YAAlC;AACA;AACD,KALD;AAMA,GAjCQ,EAiCN,CACF7B,GADE,EAEFsB,WAFE,EAGFD,YAHE,EAIFL,mBAJE,EAKFG,mBALE,CAjCM,CAAT;AAyCA,SAAO;AACNf,IAAAA,UAAU,EAAVA,UADM;AAEN4B,IAAAA,QAAQ,EAAE;AACTC,MAAAA,WAAW,EAAEjB,mBADJ;AAETkB,MAAAA,YAAY,EAAEf;AAFL;AAFJ,GAAP;AAOA","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useRef, useEffect } from '@wordpress/element';\n\nconst { clearTimeout, setTimeout } = window;\n\nconst DEBOUNCE_TIMEOUT = 200;\n\n/**\n * Hook that creates a showMover state, as well as debounced show/hide callbacks.\n *\n * @param {Object}   props                       Component props.\n * @param {Object}   props.ref                   Element reference.\n * @param {boolean}  props.isFocused             Whether the component has current focus.\n * @param {number}   [props.debounceTimeout=250] Debounce timeout in milliseconds.\n * @param {Function} [props.onChange=noop]       Callback function.\n */\nexport function useDebouncedShowMovers( {\n\tref,\n\tisFocused,\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\n\tonChange = noop,\n} ) {\n\tconst [ showMovers, setShowMovers ] = useState( false );\n\tconst timeoutRef = useRef();\n\n\tconst handleOnChange = ( nextIsFocused ) => {\n\t\tif ( ref?.current ) {\n\t\t\tsetShowMovers( nextIsFocused );\n\t\t}\n\n\t\tonChange( nextIsFocused );\n\t};\n\n\tconst getIsHovered = () => {\n\t\treturn ref?.current && ref.current.matches( ':hover' );\n\t};\n\n\tconst shouldHideMovers = () => {\n\t\tconst isHovered = getIsHovered();\n\n\t\treturn ! isFocused && ! isHovered;\n\t};\n\n\tconst clearTimeoutRef = () => {\n\t\tconst timeout = timeoutRef.current;\n\n\t\tif ( timeout && clearTimeout ) {\n\t\t\tclearTimeout( timeout );\n\t\t}\n\t};\n\n\tconst debouncedShowMovers = ( event ) => {\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t}\n\n\t\tclearTimeoutRef();\n\n\t\tif ( ! showMovers ) {\n\t\t\thandleOnChange( true );\n\t\t}\n\t};\n\n\tconst debouncedHideMovers = ( event ) => {\n\t\tif ( event ) {\n\t\t\tevent.stopPropagation();\n\t\t}\n\n\t\tclearTimeoutRef();\n\n\t\ttimeoutRef.current = setTimeout( () => {\n\t\t\tif ( shouldHideMovers() ) {\n\t\t\t\thandleOnChange( false );\n\t\t\t}\n\t\t}, debounceTimeout );\n\t};\n\n\tuseEffect( () => () => clearTimeoutRef(), [] );\n\n\treturn {\n\t\tshowMovers,\n\t\tdebouncedShowMovers,\n\t\tdebouncedHideMovers,\n\t};\n}\n\n/**\n * Hook that provides a showMovers state and gesture events for DOM elements\n * that interact with the showMovers state.\n *\n * @param {Object}   props                       Component props.\n * @param {Object}   props.ref                   Element reference.\n * @param {number}   [props.debounceTimeout=250] Debounce timeout in milliseconds.\n * @param {Function} [props.onChange=noop]       Callback function.\n */\nexport function useShowMoversGestures( {\n\tref,\n\tdebounceTimeout = DEBOUNCE_TIMEOUT,\n\tonChange = noop,\n} ) {\n\tconst [ isFocused, setIsFocused ] = useState( false );\n\tconst {\n\t\tshowMovers,\n\t\tdebouncedShowMovers,\n\t\tdebouncedHideMovers,\n\t} = useDebouncedShowMovers( { ref, debounceTimeout, isFocused, onChange } );\n\n\tconst registerRef = useRef( false );\n\n\tconst isFocusedWithin = () => {\n\t\treturn (\n\t\t\tref?.current &&\n\t\t\tref.current.contains( ref.current.ownerDocument.activeElement )\n\t\t);\n\t};\n\n\tuseEffect( () => {\n\t\tconst node = ref.current;\n\n\t\tconst handleOnFocus = () => {\n\t\t\tif ( isFocusedWithin() ) {\n\t\t\t\tsetIsFocused( true );\n\t\t\t\tdebouncedShowMovers();\n\t\t\t}\n\t\t};\n\n\t\tconst handleOnBlur = () => {\n\t\t\tif ( ! isFocusedWithin() ) {\n\t\t\t\tsetIsFocused( false );\n\t\t\t\tdebouncedHideMovers();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Events are added via DOM events (vs. React synthetic events),\n\t\t * as the child React components swallow mouse events.\n\t\t */\n\t\tif ( node && ! registerRef.current ) {\n\t\t\tnode.addEventListener( 'focus', handleOnFocus, true );\n\t\t\tnode.addEventListener( 'blur', handleOnBlur, true );\n\t\t\tregisterRef.current = true;\n\t\t}\n\n\t\treturn () => {\n\t\t\tif ( node ) {\n\t\t\t\tnode.removeEventListener( 'focus', handleOnFocus );\n\t\t\t\tnode.removeEventListener( 'blur', handleOnBlur );\n\t\t\t}\n\t\t};\n\t}, [\n\t\tref,\n\t\tregisterRef,\n\t\tsetIsFocused,\n\t\tdebouncedShowMovers,\n\t\tdebouncedHideMovers,\n\t] );\n\n\treturn {\n\t\tshowMovers,\n\t\tgestures: {\n\t\t\tonMouseMove: debouncedShowMovers,\n\t\t\tonMouseLeave: debouncedHideMovers,\n\t\t},\n\t};\n}\n"]}