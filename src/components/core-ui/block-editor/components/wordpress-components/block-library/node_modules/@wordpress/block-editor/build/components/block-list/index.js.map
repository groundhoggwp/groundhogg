{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/index.js"],"names":["BLOCK_ANIMATION_THRESHOLD","BlockList","ref","className","rootClientId","renderAppender","__experimentalTagName","__experimentalAppenderTagName","__experimentalPassedProps","selector","select","getBlockOrder","getBlockListSettings","getSelectedBlockClientId","getMultiSelectedBlockClientIds","hasMultiSelection","getGlobalBlockCount","isTyping","isDraggingBlocks","blockClientIds","selectedBlockClientId","multiSelectedBlockClientIds","orientation","enableAnimation","fallbackRef","element","Container","RootContainer","dropTargetIndex","isAppenderDropTarget","length","map","clientId","index","isBlockInSelection","includes","isDropTarget","ForwardedBlockList","props"],"mappings":";;;;;;;;;AASA;;;;AANA;;AAKA;;AAMA;;AACA;;AACA;;AACA;;AAjBA;;;;AAKA;;;;AAMA;;;;AAQA;;;;AAIA,IAAMA,yBAAyB,GAAG,GAAlC;;AAEA,SAASC,SAAT,OASCC,GATD,EAUE;AAAA,MARAC,SAQA,QARAA,SAQA;AAAA,MAPAC,YAOA,QAPAA,YAOA;AAAA,MANAC,cAMA,QANAA,cAMA;AAAA,mCALAC,qBAKA;AAAA,MALAA,qBAKA,sCALwB,KAKxB;AAAA,MAJAC,6BAIA,QAJAA,6BAIA;AAAA,mCAHAC,yBAGA;AAAA,MAHAA,yBAGA,sCAH4B,EAG5B;;AACD,WAASC,QAAT,CAAmBC,MAAnB,EAA4B;AAAA;;AAAA,kBAUvBA,MAAM,CAAE,mBAAF,CAViB;AAAA,QAE1BC,aAF0B,WAE1BA,aAF0B;AAAA,QAG1BC,oBAH0B,WAG1BA,oBAH0B;AAAA,QAI1BC,wBAJ0B,WAI1BA,wBAJ0B;AAAA,QAK1BC,8BAL0B,WAK1BA,8BAL0B;AAAA,QAM1BC,iBAN0B,WAM1BA,iBAN0B;AAAA,QAO1BC,mBAP0B,WAO1BA,mBAP0B;AAAA,QAQ1BC,QAR0B,WAQ1BA,QAR0B;AAAA,QAS1BC,gBAT0B,WAS1BA,gBAT0B;;AAY3B,WAAO;AACNC,MAAAA,cAAc,EAAER,aAAa,CAAEP,YAAF,CADvB;AAENgB,MAAAA,qBAAqB,EAAEP,wBAAwB,EAFzC;AAGNQ,MAAAA,2BAA2B,EAAEP,8BAA8B,EAHrD;AAINQ,MAAAA,WAAW,2BAAEV,oBAAoB,CAAER,YAAF,CAAtB,0DAAE,sBAAsCkB,WAJ7C;AAKNP,MAAAA,iBAAiB,EAAEA,iBAAiB,EAL9B;AAMNQ,MAAAA,eAAe,EACd,CAAEN,QAAQ,EAAV,IACAD,mBAAmB,MAAMhB,yBARpB;AASNkB,MAAAA,gBAAgB,EAAEA,gBAAgB;AAT5B,KAAP;AAWA;;AAxBA,mBAkCG,qBAAWT,QAAX,EAAqB,CAAEL,YAAF,CAArB,CAlCH;AAAA,MA2BAe,cA3BA,cA2BAA,cA3BA;AAAA,MA4BAC,qBA5BA,cA4BAA,qBA5BA;AAAA,MA6BAC,2BA7BA,cA6BAA,2BA7BA;AAAA,MA8BAC,WA9BA,cA8BAA,WA9BA;AAAA,MA+BAP,iBA/BA,cA+BAA,iBA/BA;AAAA,MAgCAQ,eAhCA,cAgCAA,eAhCA;AAAA,MAiCAL,gBAjCA,cAiCAA,gBAjCA;;AAoCD,MAAMM,WAAW,GAAG,sBAApB;AACA,MAAMC,OAAO,GAAGjB,yBAAyB,CAACN,GAA1B,IAAiCA,GAAjC,IAAwCsB,WAAxD;AAEA,MAAME,SAAS,GAAGtB,YAAY,GAAGE,qBAAH,GAA2BqB,sBAAzD;AACA,MAAMC,eAAe,GAAG,+BAAkB;AACzCH,IAAAA,OAAO,EAAPA,OADyC;AAEzCrB,IAAAA,YAAY,EAAZA;AAFyC,GAAlB,CAAxB;AAKA,MAAMyB,oBAAoB,GACzBD,eAAe,KAAKT,cAAc,CAACW,MAAnC,IAA6CZ,gBAD9C;AAGA,SACC,4BAAC,SAAD,6BACMV,yBADN;AAEC,IAAA,GAAG,EAAGiB,OAFP;AAGC,IAAA,SAAS,EAAG,yBACX,iCADW,EAEXtB,SAFW,EAGXK,yBAAyB,CAACL,SAHf;AAHb,MASGgB,cAAc,CAACY,GAAf,CAAoB,UAAEC,QAAF,EAAYC,KAAZ,EAAuB;AAC5C,QAAMC,kBAAkB,GAAGnB,iBAAiB,GACzCM,2BAA2B,CAACc,QAA5B,CAAsCH,QAAtC,CADyC,GAEzCZ,qBAAqB,KAAKY,QAF7B;AAIA,QAAMI,YAAY,GACjBR,eAAe,KAAKK,KAApB,IAA6Bf,gBAD9B;AAGA,WACC,4BAAC,uBAAD;AACC,MAAA,GAAG,EAAGc,QADP;AAEC,MAAA,KAAK,EAAG,CAAEE;AAFX,OAIC,4BAAC,cAAD;AACC,MAAA,YAAY,EAAG9B,YADhB;AAEC,MAAA,QAAQ,EAAG4B,QAFZ,CAGC;AACA;AACA;AALD;AAMC,MAAA,KAAK,EAAGC,KANT;AAOC,MAAA,eAAe,EAAGV,eAPnB;AAQC,MAAA,SAAS,EAAG,yBAAY;AACvB,0BAAkBa,YADK;AAEvB,oCACCA,YAAY,IACZd,WAAW,KAAK;AAJM,OAAZ;AARb,MAJD,CADD;AAsBA,GA9BC,CATH,EAwCC,4BAAC,0BAAD;AACC,IAAA,OAAO,EAAGf,6BADX;AAEC,IAAA,YAAY,EAAGH,YAFhB;AAGC,IAAA,cAAc,EAAGC,cAHlB;AAIC,IAAA,SAAS,EAAG,yBAAY;AACvB,wBAAkBwB,oBADK;AAEvB,kCACCA,oBAAoB,IAAIP,WAAW,KAAK;AAHlB,KAAZ;AAJb,IAxCD,CADD;AAqDA;;AAED,IAAMe,kBAAkB,GAAG,yBAAYpC,SAAZ,CAA3B,C,CAEA;AACA;AACA;;eACe,yBAAY,UAAEqC,KAAF,EAASpC,GAAT,EAAkB;AAC5C,SACC,4BAAC,uBAAD;AAAmB,IAAA,KAAK,EAAG;AAA3B,KACC,4BAAC,kBAAD;AAAoB,IAAA,GAAG,EAAGA;AAA1B,KAAqCoC,KAArC,EADD,CADD;AAKA,CANc,C","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { AsyncModeProvider, useSelect } from '@wordpress/data';\nimport { useRef, forwardRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport BlockListBlock from './block';\nimport BlockListAppender from '../block-list-appender';\nimport RootContainer from './root-container';\nimport useBlockDropZone from '../use-block-drop-zone';\n\n/**\n * If the block count exceeds the threshold, we disable the reordering animation\n * to avoid laginess.\n */\nconst BLOCK_ANIMATION_THRESHOLD = 200;\n\nfunction BlockList(\n\t{\n\t\tclassName,\n\t\trootClientId,\n\t\trenderAppender,\n\t\t__experimentalTagName = 'div',\n\t\t__experimentalAppenderTagName,\n\t\t__experimentalPassedProps = {},\n\t},\n\tref\n) {\n\tfunction selector( select ) {\n\t\tconst {\n\t\t\tgetBlockOrder,\n\t\t\tgetBlockListSettings,\n\t\t\tgetSelectedBlockClientId,\n\t\t\tgetMultiSelectedBlockClientIds,\n\t\t\thasMultiSelection,\n\t\t\tgetGlobalBlockCount,\n\t\t\tisTyping,\n\t\t\tisDraggingBlocks,\n\t\t} = select( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tblockClientIds: getBlockOrder( rootClientId ),\n\t\t\tselectedBlockClientId: getSelectedBlockClientId(),\n\t\t\tmultiSelectedBlockClientIds: getMultiSelectedBlockClientIds(),\n\t\t\torientation: getBlockListSettings( rootClientId )?.orientation,\n\t\t\thasMultiSelection: hasMultiSelection(),\n\t\t\tenableAnimation:\n\t\t\t\t! isTyping() &&\n\t\t\t\tgetGlobalBlockCount() <= BLOCK_ANIMATION_THRESHOLD,\n\t\t\tisDraggingBlocks: isDraggingBlocks(),\n\t\t};\n\t}\n\n\tconst {\n\t\tblockClientIds,\n\t\tselectedBlockClientId,\n\t\tmultiSelectedBlockClientIds,\n\t\torientation,\n\t\thasMultiSelection,\n\t\tenableAnimation,\n\t\tisDraggingBlocks,\n\t} = useSelect( selector, [ rootClientId ] );\n\n\tconst fallbackRef = useRef();\n\tconst element = __experimentalPassedProps.ref || ref || fallbackRef;\n\n\tconst Container = rootClientId ? __experimentalTagName : RootContainer;\n\tconst dropTargetIndex = useBlockDropZone( {\n\t\telement,\n\t\trootClientId,\n\t} );\n\n\tconst isAppenderDropTarget =\n\t\tdropTargetIndex === blockClientIds.length && isDraggingBlocks;\n\n\treturn (\n\t\t<Container\n\t\t\t{ ...__experimentalPassedProps }\n\t\t\tref={ element }\n\t\t\tclassName={ classnames(\n\t\t\t\t'block-editor-block-list__layout',\n\t\t\t\tclassName,\n\t\t\t\t__experimentalPassedProps.className\n\t\t\t) }\n\t\t>\n\t\t\t{ blockClientIds.map( ( clientId, index ) => {\n\t\t\t\tconst isBlockInSelection = hasMultiSelection\n\t\t\t\t\t? multiSelectedBlockClientIds.includes( clientId )\n\t\t\t\t\t: selectedBlockClientId === clientId;\n\n\t\t\t\tconst isDropTarget =\n\t\t\t\t\tdropTargetIndex === index && isDraggingBlocks;\n\n\t\t\t\treturn (\n\t\t\t\t\t<AsyncModeProvider\n\t\t\t\t\t\tkey={ clientId }\n\t\t\t\t\t\tvalue={ ! isBlockInSelection }\n\t\t\t\t\t>\n\t\t\t\t\t\t<BlockListBlock\n\t\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\t\t// This prop is explicitely computed and passed down\n\t\t\t\t\t\t\t// to avoid being impacted by the async mode\n\t\t\t\t\t\t\t// otherwise there might be a small delay to trigger the animation.\n\t\t\t\t\t\t\tindex={ index }\n\t\t\t\t\t\t\tenableAnimation={ enableAnimation }\n\t\t\t\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t\t\t\t'is-drop-target': isDropTarget,\n\t\t\t\t\t\t\t\t'is-dropping-horizontally':\n\t\t\t\t\t\t\t\t\tisDropTarget &&\n\t\t\t\t\t\t\t\t\torientation === 'horizontal',\n\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</AsyncModeProvider>\n\t\t\t\t);\n\t\t\t} ) }\n\t\t\t<BlockListAppender\n\t\t\t\ttagName={ __experimentalAppenderTagName }\n\t\t\t\trootClientId={ rootClientId }\n\t\t\t\trenderAppender={ renderAppender }\n\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t'is-drop-target': isAppenderDropTarget,\n\t\t\t\t\t'is-dropping-horizontally':\n\t\t\t\t\t\tisAppenderDropTarget && orientation === 'horizontal',\n\t\t\t\t} ) }\n\t\t\t/>\n\t\t</Container>\n\t);\n}\n\nconst ForwardedBlockList = forwardRef( BlockList );\n\n// This component needs to always be synchronous\n// as it's the one changing the async mode\n// depending on the block selection.\nexport default forwardRef( ( props, ref ) => {\n\treturn (\n\t\t<AsyncModeProvider value={ false }>\n\t\t\t<ForwardedBlockList ref={ ref } { ...props } />\n\t\t</AsyncModeProvider>\n\t);\n} );\n"]}