{"version":3,"sources":["@wordpress/components/src/mobile/image/index.native.js"],"names":["Image","Text","View","__","Icon","image","icon","usePreferredColorSchemeStyle","useEffect","useState","getImageWithFocalPointStyles","styles","SvgIconRetry","ImageEditingButton","ICON_TYPE","PLACEHOLDER","RETRY","UPLOAD","IMAGE_DEFAULT_FOCAL_POINT","x","y","ImageComponent","align","alt","editButton","focalPoint","imageHeight","height","isSelected","isUploadFailed","isUploadInProgress","mediaPickerOptions","onSelectMediaUploadOption","openMediaOptions","resizeMode","retryMessage","url","shapeStyle","imageWidth","width","imageData","setImageData","containerSize","setContainerSize","getSize","imgWidth","imgHeight","aspectRatio","onContainerLayout","event","nativeEvent","layout","getIcon","iconType","iconStyle","iconRetry","iconPlaceholderStyles","iconUploadStyles","iconPlaceholder","iconPlaceholderDark","iconUpload","iconUploadDark","placeholderStyles","imageContainerUpload","imageContainerUploadDark","imageContainerUploadWithFocalpoint","customWidth","wide","imageContainerStyles","imageContent","focalPointContainer","imageStyles","opacity","undefined","container","alignItems","imageBorder","imageUploadingIconContainer","focalPointContent","uri","resizeMethod","imageContainer","retryContainer","modalIcon","uploadFailedText"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { Image, Text, View } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Icon } from '@wordpress/components';\nimport { image as icon } from '@wordpress/icons';\nimport { usePreferredColorSchemeStyle } from '@wordpress/compose';\nimport { useEffect, useState } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { getImageWithFocalPointStyles } from './utils';\nimport styles from './style.scss';\nimport SvgIconRetry from './icon-retry';\nimport ImageEditingButton from './image-editing-button';\n\nconst ICON_TYPE = {\n\tPLACEHOLDER: 'placeholder',\n\tRETRY: 'retry',\n\tUPLOAD: 'upload',\n};\n\nexport const IMAGE_DEFAULT_FOCAL_POINT = { x: 0.5, y: 0.5 };\n\nconst ImageComponent = ( {\n\talign,\n\talt,\n\teditButton = true,\n\tfocalPoint,\n\theight: imageHeight,\n\tisSelected,\n\tisUploadFailed,\n\tisUploadInProgress,\n\tmediaPickerOptions,\n\tonSelectMediaUploadOption,\n\topenMediaOptions,\n\tresizeMode,\n\tretryMessage,\n\turl,\n\tshapeStyle,\n\twidth: imageWidth,\n} ) => {\n\tconst [ imageData, setImageData ] = useState( null );\n\tconst [ containerSize, setContainerSize ] = useState( null );\n\n\tuseEffect( () => {\n\t\tif ( url ) {\n\t\t\tImage.getSize( url, ( imgWidth, imgHeight ) => {\n\t\t\t\tsetImageData( {\n\t\t\t\t\taspectRatio: imgWidth / imgHeight,\n\t\t\t\t\twidth: imgWidth,\n\t\t\t\t\theight: imgHeight,\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t}, [ url ] );\n\n\tconst onContainerLayout = ( event ) => {\n\t\tconst { height, width } = event.nativeEvent.layout;\n\n\t\tif (\n\t\t\twidth !== 0 &&\n\t\t\theight !== 0 &&\n\t\t\t( containerSize?.width !== width ||\n\t\t\t\tcontainerSize?.height !== height )\n\t\t) {\n\t\t\tsetContainerSize( { width, height } );\n\t\t}\n\t};\n\n\tconst getIcon = ( iconType ) => {\n\t\tlet iconStyle;\n\t\tswitch ( iconType ) {\n\t\t\tcase ICON_TYPE.RETRY:\n\t\t\t\treturn <Icon icon={ SvgIconRetry } { ...styles.iconRetry } />;\n\t\t\tcase ICON_TYPE.PLACEHOLDER:\n\t\t\t\ticonStyle = iconPlaceholderStyles;\n\t\t\t\tbreak;\n\t\t\tcase ICON_TYPE.UPLOAD:\n\t\t\t\ticonStyle = iconUploadStyles;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn <Icon icon={ icon } { ...iconStyle } />;\n\t};\n\n\tconst iconPlaceholderStyles = usePreferredColorSchemeStyle(\n\t\tstyles.iconPlaceholder,\n\t\tstyles.iconPlaceholderDark\n\t);\n\n\tconst iconUploadStyles = usePreferredColorSchemeStyle(\n\t\tstyles.iconUpload,\n\t\tstyles.iconUploadDark\n\t);\n\n\tconst placeholderStyles = [\n\t\tusePreferredColorSchemeStyle(\n\t\t\tstyles.imageContainerUpload,\n\t\t\tstyles.imageContainerUploadDark\n\t\t),\n\t\tfocalPoint && styles.imageContainerUploadWithFocalpoint,\n\t\timageHeight && { height: imageHeight },\n\t];\n\n\tconst customWidth =\n\t\timageData?.width < containerSize?.width\n\t\t\t? imageData?.width\n\t\t\t: styles.wide.width;\n\n\tconst imageContainerStyles = [\n\t\tstyles.imageContent,\n\t\t{\n\t\t\twidth:\n\t\t\t\timageWidth === styles.wide.width ||\n\t\t\t\t( imageData &&\n\t\t\t\t\timageWidth > 0 &&\n\t\t\t\t\timageWidth < containerSize?.width )\n\t\t\t\t\t? imageWidth\n\t\t\t\t\t: customWidth,\n\t\t},\n\t\tresizeMode && { width: styles.wide.width },\n\t\tfocalPoint && styles.focalPointContainer,\n\t];\n\n\tconst imageStyles = [\n\t\t{\n\t\t\topacity: isUploadInProgress ? 0.3 : 1,\n\t\t\theight: containerSize?.height,\n\t\t},\n\t\tfocalPoint && styles.focalPoint,\n\t\tfocalPoint &&\n\t\t\tgetImageWithFocalPointStyles(\n\t\t\t\tfocalPoint,\n\t\t\t\tcontainerSize,\n\t\t\t\timageData\n\t\t\t),\n\t\t! focalPoint &&\n\t\t\timageData &&\n\t\t\tcontainerSize && {\n\t\t\t\theight:\n\t\t\t\t\timageData?.width > containerSize?.width\n\t\t\t\t\t\t? containerSize?.width / imageData?.aspectRatio\n\t\t\t\t\t\t: undefined,\n\t\t\t},\n\t\timageHeight && { height: imageHeight },\n\t\tshapeStyle,\n\t];\n\n\treturn (\n\t\t<View\n\t\t\tstyle={ [\n\t\t\t\tstyles.container,\n\t\t\t\t// only set alignItems if an image exists because alignItems causes the placeholder\n\t\t\t\t// to disappear when an aligned image can't be downloaded\n\t\t\t\t// https://github.com/wordpress-mobile/gutenberg-mobile/issues/1592\n\t\t\t\timageData && align && { alignItems: align },\n\t\t\t] }\n\t\t\tonLayout={ onContainerLayout }\n\t\t>\n\t\t\t<View\n\t\t\t\taccessible\n\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\taccessibilityLabel={ alt }\n\t\t\t\taccessibilityHint={ __( 'Double tap and hold to edit' ) }\n\t\t\t\taccessibilityRole={ 'imagebutton' }\n\t\t\t\tkey={ url }\n\t\t\t\tstyle={ imageContainerStyles }\n\t\t\t>\n\t\t\t\t{ isSelected && ! ( isUploadInProgress || isUploadFailed ) && (\n\t\t\t\t\t<View\n\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\tstyles.imageBorder,\n\t\t\t\t\t\t\t{ height: containerSize?.height },\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\n\t\t\t\t{ ! imageData ? (\n\t\t\t\t\t<View style={ placeholderStyles }>\n\t\t\t\t\t\t<View style={ styles.imageUploadingIconContainer }>\n\t\t\t\t\t\t\t{ getIcon( ICON_TYPE.UPLOAD ) }\n\t\t\t\t\t\t</View>\n\t\t\t\t\t</View>\n\t\t\t\t) : (\n\t\t\t\t\t<View style={ focalPoint && styles.focalPointContent }>\n\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t{ ...( ! resizeMode && {\n\t\t\t\t\t\t\t\taspectRatio: imageData?.aspectRatio,\n\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\tstyle={ imageStyles }\n\t\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\t\t{ ...( ! focalPoint && {\n\t\t\t\t\t\t\t\tresizeMethod: 'scale',\n\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\tresizeMode={ resizeMode }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\n\t\t\t\t{ isUploadFailed && retryMessage && (\n\t\t\t\t\t<View\n\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\tstyles.imageContainer,\n\t\t\t\t\t\t\tstyles.retryContainer,\n\t\t\t\t\t\t] }\n\t\t\t\t\t>\n\t\t\t\t\t\t<View style={ styles.modalIcon }>\n\t\t\t\t\t\t\t{ getIcon( ICON_TYPE.RETRY ) }\n\t\t\t\t\t\t</View>\n\t\t\t\t\t\t<Text style={ styles.uploadFailedText }>\n\t\t\t\t\t\t\t{ retryMessage }\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\n\t\t\t\t{ editButton &&\n\t\t\t\t\tisSelected &&\n\t\t\t\t\t! isUploadInProgress &&\n\t\t\t\t\t! isUploadFailed && (\n\t\t\t\t\t\t<ImageEditingButton\n\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\tonSelectMediaUploadOption\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\topenMediaOptions={ openMediaOptions }\n\t\t\t\t\t\t\turl={ imageData && url }\n\t\t\t\t\t\t\tpickerOptions={ mediaPickerOptions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t</View>\n\t\t</View>\n\t);\n};\n\nexport default ImageComponent;\n"]}