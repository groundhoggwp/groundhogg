{"version":3,"sources":["@wordpress/components/src/custom-gradient-picker/control-points.js"],"names":["ControlPointKeyboardMove","arguments","increase","bind","decrease","shortcuts","right","left","event","stopPropagation","props","gradientIndex","onChange","gradientAST","children","Component","ControlPointButton","isOpen","position","color","additionalProps","instanceId","descriptionId","ControlPoints","gradientPickerDomRef","ignoreMarkerPosition","markerPoints","onStartControlPointChange","onStopControlPointChange","controlPointMoveState","onMouseMove","relativePosition","clientX","current","GRADIENT_MARKERS_WIDTH","referenceGradientAST","significantMoveHappened","initialPosition","colorStops","length","value","Math","abs","MINIMUM_SIGNIFICANT_MOVE","cleanEventListeners","window","removeEventListener","listenersActivated","map","point","index","positionValue","onToggle","addEventListener","onClose","rgb","COLOR_POPOVER_PROPS"],"mappings":";;;;;;;;;AAQA;;;;;;;;;;;;;;;;;;AALA;;AAMA;;AACA;;AAKA;;AACA;;AACA;;AACA;;AACA;;AASA;;AAKA;;;;;;IAEMA,wB;;;;;AACL,sCAAc;AAAA;;AAAA;AACb,+BAAUC,SAAV;AACA,UAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcC,IAAd,6CAAhB;AACA,UAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcD,IAAd,6CAAhB;AACA,UAAKE,SAAL,GAAiB;AAChBC,MAAAA,KAAK,EAAE,MAAKJ,QADI;AAEhBK,MAAAA,IAAI,EAAE,MAAKH;AAFK,KAAjB;AAJa;AAQb;;;;6BACSI,K,EAAQ;AACjB;AACA;AACAA,MAAAA,KAAK,CAACC,eAAN;AAHiB,wBAIgC,KAAKC,KAJrC;AAAA,UAITC,aAJS,eAITA,aAJS;AAAA,UAIMC,QAJN,eAIMA,QAJN;AAAA,UAIgBC,WAJhB,eAIgBA,WAJhB;AAKjBD,MAAAA,QAAQ,CACP,oDACCC,WADD,EAECF,aAFD,CADO,CAAR;AAMA;;;6BAESH,K,EAAQ;AACjB;AACA;AACAA,MAAAA,KAAK,CAACC,eAAN;AAHiB,yBAIgC,KAAKC,KAJrC;AAAA,UAITC,aAJS,gBAITA,aAJS;AAAA,UAIMC,QAJN,gBAIMA,QAJN;AAAA,UAIgBC,WAJhB,gBAIgBA,WAJhB;AAKjBD,MAAAA,QAAQ,CACP,oDACCC,WADD,EAECF,aAFD,CADO,CAAR;AAMA;;;6BACQ;AAAA,UACAG,QADA,GACa,KAAKJ,KADlB,CACAI,QADA;AAER,aACC,4BAAC,0BAAD;AAAmB,QAAA,SAAS,EAAG,KAAKT;AAApC,SACGS,QADH,CADD;AAKA;;;EA1CqCC,kB;;AA6CvC,SAASC,kBAAT,OAQI;AAAA,MAPHC,MAOG,QAPHA,MAOG;AAAA,MANHC,QAMG,QANHA,QAMG;AAAA,MALHC,KAKG,QALHA,KAKG;AAAA,MAJHP,QAIG,QAJHA,QAIG;AAAA,MAHHD,aAGG,QAHHA,aAGG;AAAA,MAFHE,WAEG,QAFHA,WAEG;AAAA,MADAO,eACA;AACH,MAAMC,UAAU,GAAG,4BAAeL,kBAAf,CAAnB;AACA,MAAMM,aAAa,iFAA2ED,UAA3E,CAAnB;AACA,SACC,4BAAC,wBAAD;AACC,IAAA,QAAQ,EAAGT,QADZ;AAEC,IAAA,aAAa,EAAGD,aAFjB;AAGC,IAAA,WAAW,EAAGE;AAHf,KAKC,4BAAC,eAAD;AACC,kBAAa,oBACZ;AACA,kBACC,+DADD,CAFY,EAKZK,QALY,EAMZC,KANY,CADd;AASC,wBAAmBG,aATpB;AAUC,qBAAc,MAVf;AAWC,qBAAgBL,MAXjB;AAYC,IAAA,SAAS,EAAG,yBACX,yDADW,EAEX;AACC,mBAAaA;AADd,KAFW,CAZb;AAkBC,IAAA,KAAK,EAAG;AACPV,MAAAA,IAAI,EAAEW;AADC;AAlBT,KAqBME,eArBN,EALD,EA4BC,4BAAC,uBAAD;AAAgB,IAAA,EAAE,EAAGE;AAArB,KACG,cACD,sKADC,CADH,CA5BD,CADD;AAoCA;;AAEc,SAASC,aAAT,QAQX;AAAA,MAPHC,oBAOG,SAPHA,oBAOG;AAAA,MANHC,oBAMG,SANHA,oBAMG;AAAA,MALHC,YAKG,SALHA,YAKG;AAAA,MAJHd,QAIG,SAJHA,QAIG;AAAA,MAHHC,WAGG,SAHHA,WAGG;AAAA,MAFHc,yBAEG,SAFHA,yBAEG;AAAA,MADHC,wBACG,SADHA,wBACG;AACH,MAAMC,qBAAqB,GAAG,sBAA9B;;AAEA,MAAMC,WAAW,GAAG,SAAdA,WAAc,CAAEtB,KAAF,EAAa;AAChC,QAAMuB,gBAAgB,GAAG,kDACxBvB,KAAK,CAACwB,OADkB,EAExBR,oBAAoB,CAACS,OAFG,EAGxBC,iCAHwB,CAAzB;AADgC,gCAU5BL,qBAAqB,CAACI,OAVM;AAAA,QAOlBE,oBAPkB,yBAO/BtB,WAP+B;AAAA,QAQ/BK,QAR+B,yBAQ/BA,QAR+B;AAAA,QAS/BkB,uBAT+B,yBAS/BA,uBAT+B;;AAWhC,QAAK,CAAEA,uBAAP,EAAiC;AAChC,UAAMC,eAAe,GACpBF,oBAAoB,CAACG,UAArB,CAAiCpB,QAAjC,EAA4CqB,MAA5C,CAAmDC,KADpD;;AAEA,UACCC,IAAI,CAACC,GAAL,CAAUL,eAAe,GAAGN,gBAA5B,KACAY,mCAFD,EAGE;AACDd,QAAAA,qBAAqB,CAACI,OAAtB,CAA8BG,uBAA9B,GAAwD,IAAxD;AACA;AACD;;AAED,QACC,CAAE,sCACDD,oBADC,EAEDJ,gBAFC,EAGDb,QAHC,CADH,EAME;AACDN,MAAAA,QAAQ,CACP,kDACCuB,oBADD,EAECjB,QAFD,EAGCa,gBAHD,CADO,CAAR;AAOA;AACD,GArCD;;AAuCA,MAAMa,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;AACjC,QACCC,MAAM,IACNA,MAAM,CAACC,mBADP,IAEAjB,qBAAqB,CAACI,OAFtB,IAGAJ,qBAAqB,CAACI,OAAtB,CAA8Bc,kBAJ/B,EAKE;AACDF,MAAAA,MAAM,CAACC,mBAAP,CAA4B,WAA5B,EAAyChB,WAAzC;AACAe,MAAAA,MAAM,CAACC,mBAAP,CAA4B,SAA5B,EAAuCF,mBAAvC;AACAhB,MAAAA,wBAAwB;AACxBC,MAAAA,qBAAqB,CAACI,OAAtB,CAA8Bc,kBAA9B,GAAmD,KAAnD;AACA;AACD,GAZD;;AAcA,0BAAW,YAAM;AAChB,WAAO,YAAM;AACZH,MAAAA,mBAAmB;AACnB,KAFD;AAGA,GAJD,EAIG,EAJH;AAMA,SAAOlB,YAAY,CAACsB,GAAb,CACN,UAAEC,KAAF,EAASC,KAAT;AAAA,WACCD,KAAK,IACLxB,oBAAoB,KAAKwB,KAAK,CAACE,aAD/B,IAEC,4BAAC,iBAAD;AACC,MAAA,GAAG,EAAGD,KADP;AAEC,MAAA,OAAO,EAAGtB,wBAFX;AAGC,MAAA,YAAY,EAAG;AAAA,YAAIX,MAAJ,SAAIA,MAAJ;AAAA,YAAYmC,QAAZ,SAAYA,QAAZ;AAAA,eACd,4BAAC,kBAAD;AACC,UAAA,GAAG,EAAGF,KADP;AAEC,UAAA,OAAO,EAAG,mBAAM;AACf,gBACCrB,qBAAqB,CAACI,OAAtB,IACAJ,qBAAqB,CAACI,OAAtB,CACEG,uBAHH,EAIE;AACD;AACA;;AACD,gBAAKnB,MAAL,EAAc;AACbW,cAAAA,wBAAwB;AACxB,aAFD,MAEO;AACND,cAAAA,yBAAyB;AACzB;;AACDyB,YAAAA,QAAQ;AACR,WAhBF;AAiBC,UAAA,WAAW,EAAG,uBAAM;AACnB,gBAAKP,MAAM,IAAIA,MAAM,CAACQ,gBAAtB,EAAyC;AACxCxB,cAAAA,qBAAqB,CAACI,OAAtB,GAAgC;AAC/BpB,gBAAAA,WAAW,EAAXA,WAD+B;AAE/BK,gBAAAA,QAAQ,EAAEgC,KAFqB;AAG/Bd,gBAAAA,uBAAuB,EAAE,KAHM;AAI/BW,gBAAAA,kBAAkB,EAAE;AAJW,eAAhC;AAMApB,cAAAA,yBAAyB;AACzBkB,cAAAA,MAAM,CAACQ,gBAAP,CACC,WADD,EAECvB,WAFD;AAIAe,cAAAA,MAAM,CAACQ,gBAAP,CACC,SADD,EAECT,mBAFD;AAIA;AACD,WAnCF;AAoCC,UAAA,MAAM,EAAG3B,MApCV;AAqCC,UAAA,QAAQ,EAAGgC,KAAK,CAAC/B,QArClB;AAsCC,UAAA,KAAK,EAAG+B,KAAK,CAAC9B,KAtCf;AAuCC,UAAA,QAAQ,EAAGP,QAvCZ;AAwCC,UAAA,WAAW,EAAGC,WAxCf;AAyCC,UAAA,aAAa,EAAGqC;AAzCjB,UADc;AAAA,OAHhB;AAgDC,MAAA,aAAa,EAAG;AAAA,YAAII,OAAJ,SAAIA,OAAJ;AAAA,eACf,qDACC,4BAAC,oBAAD;AACC,UAAA,KAAK,EAAGL,KAAK,CAAC9B,KADf;AAEC,UAAA,gBAAgB,EAAG,iCAAe;AAAA,gBAAXoC,GAAW,SAAXA,GAAW;AACjC3C,YAAAA,QAAQ,CACP,+CACCC,WADD,EAECqC,KAFD,EAGCK,GAHD,CADO,CAAR;AAOA;AAVF,UADD,EAaC,4BAAC,eAAD;AACC,UAAA,SAAS,EAAC,yDADX;AAEC,UAAA,OAAO,EAAG,mBAAM;AACf3C,YAAAA,QAAQ,CACP,+CACCC,WADD,EAECqC,KAFD,CADO,CAAR;AAMAI,YAAAA,OAAO;AACP,WAVF;AAWC,UAAA,MAAM;AAXP,WAaG,cAAI,sBAAJ,CAbH,CAbD,CADe;AAAA,OAhDjB;AA+EC,MAAA,YAAY,EAAGE;AA/EhB,MAHF;AAAA,GADM,CAAP;AAuFA","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component, useEffect, useRef } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { useInstanceId } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport Button from '../button';\nimport ColorPicker from '../color-picker';\nimport Dropdown from '../dropdown';\nimport VisuallyHidden from '../visually-hidden';\nimport {\n\tgetGradientWithColorAtIndexChanged,\n\tgetGradientWithControlPointRemoved,\n\tgetGradientWithPositionAtIndexChanged,\n\tgetGradientWithPositionAtIndexDecreased,\n\tgetGradientWithPositionAtIndexIncreased,\n\tgetHorizontalRelativeGradientPosition,\n\tisControlPointOverlapping,\n} from './utils';\nimport {\n\tCOLOR_POPOVER_PROPS,\n\tGRADIENT_MARKERS_WIDTH,\n\tMINIMUM_SIGNIFICANT_MOVE,\n} from './constants';\nimport KeyboardShortcuts from '../keyboard-shortcuts';\n\nclass ControlPointKeyboardMove extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.increase = this.increase.bind( this );\n\t\tthis.decrease = this.decrease.bind( this );\n\t\tthis.shortcuts = {\n\t\t\tright: this.increase,\n\t\t\tleft: this.decrease,\n\t\t};\n\t}\n\tincrease( event ) {\n\t\t// Stop propagation of the key press event to avoid focus moving\n\t\t// to another editor area.\n\t\tevent.stopPropagation();\n\t\tconst { gradientIndex, onChange, gradientAST } = this.props;\n\t\tonChange(\n\t\t\tgetGradientWithPositionAtIndexIncreased(\n\t\t\t\tgradientAST,\n\t\t\t\tgradientIndex\n\t\t\t)\n\t\t);\n\t}\n\n\tdecrease( event ) {\n\t\t// Stop propagation of the key press event to avoid focus moving\n\t\t// to another editor area.\n\t\tevent.stopPropagation();\n\t\tconst { gradientIndex, onChange, gradientAST } = this.props;\n\t\tonChange(\n\t\t\tgetGradientWithPositionAtIndexDecreased(\n\t\t\t\tgradientAST,\n\t\t\t\tgradientIndex\n\t\t\t)\n\t\t);\n\t}\n\trender() {\n\t\tconst { children } = this.props;\n\t\treturn (\n\t\t\t<KeyboardShortcuts shortcuts={ this.shortcuts }>\n\t\t\t\t{ children }\n\t\t\t</KeyboardShortcuts>\n\t\t);\n\t}\n}\n\nfunction ControlPointButton( {\n\tisOpen,\n\tposition,\n\tcolor,\n\tonChange,\n\tgradientIndex,\n\tgradientAST,\n\t...additionalProps\n} ) {\n\tconst instanceId = useInstanceId( ControlPointButton );\n\tconst descriptionId = `components-custom-gradient-picker__control-point-button-description-${ instanceId }`;\n\treturn (\n\t\t<ControlPointKeyboardMove\n\t\t\tonChange={ onChange }\n\t\t\tgradientIndex={ gradientIndex }\n\t\t\tgradientAST={ gradientAST }\n\t\t>\n\t\t\t<Button\n\t\t\t\taria-label={ sprintf(\n\t\t\t\t\t// translators: %1$s: gradient position e.g: 70%, %2$s: gradient color code e.g: rgb(52,121,151).\n\t\t\t\t\t__(\n\t\t\t\t\t\t'Gradient control point at position %1$s with color code %2$s.'\n\t\t\t\t\t),\n\t\t\t\t\tposition,\n\t\t\t\t\tcolor\n\t\t\t\t) }\n\t\t\t\taria-describedby={ descriptionId }\n\t\t\t\taria-haspopup=\"true\"\n\t\t\t\taria-expanded={ isOpen }\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\t'components-custom-gradient-picker__control-point-button',\n\t\t\t\t\t{\n\t\t\t\t\t\t'is-active': isOpen,\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t\tstyle={ {\n\t\t\t\t\tleft: position,\n\t\t\t\t} }\n\t\t\t\t{ ...additionalProps }\n\t\t\t/>\n\t\t\t<VisuallyHidden id={ descriptionId }>\n\t\t\t\t{ __(\n\t\t\t\t\t'Use your left or right arrow keys or drag and drop with the mouse to change the gradient position. Press the button to change the color or remove the control point.'\n\t\t\t\t) }\n\t\t\t</VisuallyHidden>\n\t\t</ControlPointKeyboardMove>\n\t);\n}\n\nexport default function ControlPoints( {\n\tgradientPickerDomRef,\n\tignoreMarkerPosition,\n\tmarkerPoints,\n\tonChange,\n\tgradientAST,\n\tonStartControlPointChange,\n\tonStopControlPointChange,\n} ) {\n\tconst controlPointMoveState = useRef();\n\n\tconst onMouseMove = ( event ) => {\n\t\tconst relativePosition = getHorizontalRelativeGradientPosition(\n\t\t\tevent.clientX,\n\t\t\tgradientPickerDomRef.current,\n\t\t\tGRADIENT_MARKERS_WIDTH\n\t\t);\n\t\tconst {\n\t\t\tgradientAST: referenceGradientAST,\n\t\t\tposition,\n\t\t\tsignificantMoveHappened,\n\t\t} = controlPointMoveState.current;\n\t\tif ( ! significantMoveHappened ) {\n\t\t\tconst initialPosition =\n\t\t\t\treferenceGradientAST.colorStops[ position ].length.value;\n\t\t\tif (\n\t\t\t\tMath.abs( initialPosition - relativePosition ) >=\n\t\t\t\tMINIMUM_SIGNIFICANT_MOVE\n\t\t\t) {\n\t\t\t\tcontrolPointMoveState.current.significantMoveHappened = true;\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\t! isControlPointOverlapping(\n\t\t\t\treferenceGradientAST,\n\t\t\t\trelativePosition,\n\t\t\t\tposition\n\t\t\t)\n\t\t) {\n\t\t\tonChange(\n\t\t\t\tgetGradientWithPositionAtIndexChanged(\n\t\t\t\t\treferenceGradientAST,\n\t\t\t\t\tposition,\n\t\t\t\t\trelativePosition\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t};\n\n\tconst cleanEventListeners = () => {\n\t\tif (\n\t\t\twindow &&\n\t\t\twindow.removeEventListener &&\n\t\t\tcontrolPointMoveState.current &&\n\t\t\tcontrolPointMoveState.current.listenersActivated\n\t\t) {\n\t\t\twindow.removeEventListener( 'mousemove', onMouseMove );\n\t\t\twindow.removeEventListener( 'mouseup', cleanEventListeners );\n\t\t\tonStopControlPointChange();\n\t\t\tcontrolPointMoveState.current.listenersActivated = false;\n\t\t}\n\t};\n\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\tcleanEventListeners();\n\t\t};\n\t}, [] );\n\n\treturn markerPoints.map(\n\t\t( point, index ) =>\n\t\t\tpoint &&\n\t\t\tignoreMarkerPosition !== point.positionValue && (\n\t\t\t\t<Dropdown\n\t\t\t\t\tkey={ index }\n\t\t\t\t\tonClose={ onStopControlPointChange }\n\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t\t\t<ControlPointButton\n\t\t\t\t\t\t\tkey={ index }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tcontrolPointMoveState.current &&\n\t\t\t\t\t\t\t\t\tcontrolPointMoveState.current\n\t\t\t\t\t\t\t\t\t\t.significantMoveHappened\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ( isOpen ) {\n\t\t\t\t\t\t\t\t\tonStopControlPointChange();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tonStartControlPointChange();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tonToggle();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tonMouseDown={ () => {\n\t\t\t\t\t\t\t\tif ( window && window.addEventListener ) {\n\t\t\t\t\t\t\t\t\tcontrolPointMoveState.current = {\n\t\t\t\t\t\t\t\t\t\tgradientAST,\n\t\t\t\t\t\t\t\t\t\tposition: index,\n\t\t\t\t\t\t\t\t\t\tsignificantMoveHappened: false,\n\t\t\t\t\t\t\t\t\t\tlistenersActivated: true,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tonStartControlPointChange();\n\t\t\t\t\t\t\t\t\twindow.addEventListener(\n\t\t\t\t\t\t\t\t\t\t'mousemove',\n\t\t\t\t\t\t\t\t\t\tonMouseMove\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\twindow.addEventListener(\n\t\t\t\t\t\t\t\t\t\t'mouseup',\n\t\t\t\t\t\t\t\t\t\tcleanEventListeners\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tisOpen={ isOpen }\n\t\t\t\t\t\t\tposition={ point.position }\n\t\t\t\t\t\t\tcolor={ point.color }\n\t\t\t\t\t\t\tonChange={ onChange }\n\t\t\t\t\t\t\tgradientAST={ gradientAST }\n\t\t\t\t\t\t\tgradientIndex={ index }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ColorPicker\n\t\t\t\t\t\t\t\tcolor={ point.color }\n\t\t\t\t\t\t\t\tonChangeComplete={ ( { rgb } ) => {\n\t\t\t\t\t\t\t\t\tonChange(\n\t\t\t\t\t\t\t\t\t\tgetGradientWithColorAtIndexChanged(\n\t\t\t\t\t\t\t\t\t\t\tgradientAST,\n\t\t\t\t\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t\t\t\t\trgb\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"components-custom-gradient-picker__remove-control-point\"\n\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\tonChange(\n\t\t\t\t\t\t\t\t\t\tgetGradientWithControlPointRemoved(\n\t\t\t\t\t\t\t\t\t\t\tgradientAST,\n\t\t\t\t\t\t\t\t\t\t\tindex\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tisLink\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ __( 'Remove Control Point' ) }\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t\tpopoverProps={ COLOR_POPOVER_PROPS }\n\t\t\t\t/>\n\t\t\t)\n\t);\n}\n"]}