{"version":3,"sources":["@wordpress/blocks/src/api/raw-handling/normalise-blocks.js"],"names":["window","Node","ELEMENT_NODE","TEXT_NODE","normaliseBlocks","HTML","decuDoc","document","implementation","createHTMLDocument","accuDoc","decu","body","accu","innerHTML","firstChild","node","nodeType","nodeValue","trim","removeChild","lastChild","nodeName","appendChild","createElement","nextSibling","hasChildNodes"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { isEmpty, isPhrasingContent } from '@wordpress/dom';\n\n/**\n * Browser dependencies\n */\nconst { ELEMENT_NODE, TEXT_NODE } = window.Node;\n\nexport default function normaliseBlocks( HTML ) {\n\tconst decuDoc = document.implementation.createHTMLDocument( '' );\n\tconst accuDoc = document.implementation.createHTMLDocument( '' );\n\n\tconst decu = decuDoc.body;\n\tconst accu = accuDoc.body;\n\n\tdecu.innerHTML = HTML;\n\n\twhile ( decu.firstChild ) {\n\t\tconst node = decu.firstChild;\n\n\t\t// Text nodes: wrap in a paragraph, or append to previous.\n\t\tif ( node.nodeType === TEXT_NODE ) {\n\t\t\tif ( ! node.nodeValue.trim() ) {\n\t\t\t\tdecu.removeChild( node );\n\t\t\t} else {\n\t\t\t\tif ( ! accu.lastChild || accu.lastChild.nodeName !== 'P' ) {\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\n\t\t\t\t}\n\n\t\t\t\taccu.lastChild.appendChild( node );\n\t\t\t}\n\t\t\t// Element nodes.\n\t\t} else if ( node.nodeType === ELEMENT_NODE ) {\n\t\t\t// BR nodes: create a new paragraph on double, or append to previous.\n\t\t\tif ( node.nodeName === 'BR' ) {\n\t\t\t\tif ( node.nextSibling && node.nextSibling.nodeName === 'BR' ) {\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\n\t\t\t\t\tdecu.removeChild( node.nextSibling );\n\t\t\t\t}\n\n\t\t\t\t// Don't append to an empty paragraph.\n\t\t\t\tif (\n\t\t\t\t\taccu.lastChild &&\n\t\t\t\t\taccu.lastChild.nodeName === 'P' &&\n\t\t\t\t\taccu.lastChild.hasChildNodes()\n\t\t\t\t) {\n\t\t\t\t\taccu.lastChild.appendChild( node );\n\t\t\t\t} else {\n\t\t\t\t\tdecu.removeChild( node );\n\t\t\t\t}\n\t\t\t} else if ( node.nodeName === 'P' ) {\n\t\t\t\t// Only append non-empty paragraph nodes.\n\t\t\t\tif ( isEmpty( node ) ) {\n\t\t\t\t\tdecu.removeChild( node );\n\t\t\t\t} else {\n\t\t\t\t\taccu.appendChild( node );\n\t\t\t\t}\n\t\t\t} else if ( isPhrasingContent( node ) ) {\n\t\t\t\tif ( ! accu.lastChild || accu.lastChild.nodeName !== 'P' ) {\n\t\t\t\t\taccu.appendChild( accuDoc.createElement( 'P' ) );\n\t\t\t\t}\n\t\t\t\taccu.lastChild.appendChild( node );\n\t\t\t} else {\n\t\t\t\taccu.appendChild( node );\n\t\t\t}\n\t\t} else {\n\t\t\tdecu.removeChild( node );\n\t\t}\n\t}\n\n\treturn accu.innerHTML;\n}\n"]}